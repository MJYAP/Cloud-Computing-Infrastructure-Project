(dbfs:/FileStore/LiveMart/Adapter/CustomExpandableListAdapter.java,package com.example.oop_project.Main.Adapter;

import android.content.Context;
import android.graphics.Typeface;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.BaseExpandableListAdapter;
import android.widget.TextView;

import com.example.oop_project.R;

import java.util.List;
import java.util.Map;

public class CustomExpandableListAdapter extends BaseExpandableListAdapter {
    private Context context;
    private List<String> listTitle;
    private Map<String,List<String>> listItem;

    public CustomExpandableListAdapter(Context context,List<String> listTitle,Map<String,List<String>> listItem){
        this.context = context;
        this.listTitle = listTitle;
        this.listItem = listItem;
    }
    @Override
    public int getGroupCount() {
        return listTitle.size();
    }

    @Override
    public int getChildrenCount(int groupPosition) {
        return listItem.size();
    }

    @Override
    public Object getGroup(int groupPosition) {
        return listTitle.get(groupPosition);
    }

    @Override
    public Object getChild(int groupPosition, int childPosition) {
        return listItem.get(listTitle.get(groupPosition)).get(childPosition);
    }

    @Override
    public long getGroupId(int groupPosition) {
        return groupPosition;
    }

    @Override
    public long getChildId(int groupPosition, int childPosition) {
        return childPosition;
    }

    @Override
    public boolean hasStableIds() {
        return false;
    }

    @Override
    public View getGroupView(int groupPosition, boolean isExpanded, View convertView, ViewGroup parent) {
        String title = (String) getGroup(groupPosition);
        if(convertView==null){
            convertView = LayoutInflater.from(context).inflate(R.layout.list_group,null);
        }
        TextView txtTitle = (TextView)convertView.findViewById(R.id.listTitle);
        txtTitle.setTypeface(null, Typeface.BOLD);
        txtTitle.setText(title);
        return convertView;
    }

    @Override
    public View getChildView(int groupPosition, int childPosition, boolean isLastChild, View convertView, ViewGroup parent) {
        String title = (String) getChild(groupPosition,childPosition);
        if(convertView==null){
            convertView = LayoutInflater.from(context).inflate(R.layout.list_item,null);
        }
        TextView txtChild = (TextView)convertView.findViewById(R.id.expandableListItem);
        txtChild.setText(title);
        return convertView;
    }

    @Override
    public boolean isChildSelectable(int groupPosition, int childPosition) {
        return true;
    }
}
)
(dbfs:/FileStore/LiveMart/Admin/Admin.java,package com.example.oop_project.Main.Admin;

import android.os.Bundle;

import androidx.fragment.app.Fragment;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;

import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;

import com.example.oop_project.Main.Customer.adapter_sub;
import com.example.oop_project.Main.Customer.model_category;
import com.example.oop_project.Main.Customer.model_subcategory;
import com.example.oop_project.Main.Customer.myadapterCustomerCategory;
import com.example.oop_project.R;
import com.firebase.ui.database.FirebaseRecyclerOptions;
import com.google.firebase.database.FirebaseDatabase;


public class Admin extends Fragment {

    RecyclerView recview;
    adminadapter adapter;

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        // Inflate the layout for this fragment
        View view = inflater.inflate(R.layout.categories, container, false);


        recview = (RecyclerView) view.findViewById(R.id.recview);
        recview.setLayoutManager(new LinearLayoutManager(getContext()));

        FirebaseRecyclerOptions<model_category> options =
                new FirebaseRecyclerOptions.Builder<model_category>()
                        .setQuery(FirebaseDatabase.getInstance().getReference().child("Products").child("Categories"), model_category.class)
                        .build();

        adapter = new adminadapter(options);
        recview.setAdapter(adapter);

        return view;


    }
    @Override
    public void onStart() {
        super.onStart();
        adapter.startListening();
    }

    @Override
    public void onStop() {
        super.onStop();
        adapter.stopListening();
    }
})
(dbfs:/FileStore/LiveMart/Admin/Adminsub.java,package com.example.oop_project.Main.Admin;

import android.os.Bundle;

import androidx.fragment.app.Fragment;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;

import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;

import com.example.oop_project.Main.Customer.adapter_sub;
import com.example.oop_project.Main.Customer.model_subcategory;
import com.example.oop_project.R;
import com.firebase.ui.database.FirebaseRecyclerOptions;
import com.google.firebase.database.FirebaseDatabase;


public class Adminsub extends Fragment {

    String pname;
    RecyclerView recview;
    admin_subadapter adapter;

    public Adminsub() {

    }

    public Adminsub(String pname) {
        this.pname=pname;

    }

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        View view=inflater.inflate(R.layout.categories2, container, false);

        recview = (RecyclerView) view.findViewById(R.id.recview2);
        recview.setLayoutManager(new LinearLayoutManager(getContext()));

        Log.i("pract","this is" +pname);

        FirebaseRecyclerOptions<model_subcategory> options =
                new FirebaseRecyclerOptions.Builder<model_subcategory>()
                        .setQuery(FirebaseDatabase.getInstance().getReference().child("Products").child(pname),model_subcategory.class)
                        .build();
        adapter = new admin_subadapter(options,pname);
        recview.setAdapter(adapter);


        return  view;
    }
    @Override
    public void onStart() {
        super.onStart();
        adapter.startListening();
    }

    @Override
    public void onStop() {
        super.onStop();
        adapter.stopListening();
    }
})
(dbfs:/FileStore/LiveMart/Admin/admin_subadapter.java,package com.example.oop_project.Main.Admin;

import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Button;
import android.widget.EditText;
import android.widget.ImageView;
import android.widget.TextView;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;
import androidx.recyclerview.widget.RecyclerView;

import com.bumptech.glide.Glide;
import com.example.oop_project.Main.Customer.CustomerShopList;
import com.example.oop_project.Main.Customer.model_subcategory;
import com.example.oop_project.R;
import com.firebase.ui.database.FirebaseRecyclerAdapter;
import com.firebase.ui.database.FirebaseRecyclerOptions;
import com.google.firebase.database.DatabaseError;
import com.google.firebase.database.DatabaseReference;
import com.google.firebase.database.FirebaseDatabase;

import java.util.HashMap;

public class admin_subadapter extends FirebaseRecyclerAdapter<model_subcategory, admin_subadapter.myviewholder> {
    String catname;

    public admin_subadapter(@NonNull FirebaseRecyclerOptions<model_subcategory> options, String category) {
        super(options);
        catname=category;
    }

    @Override
    public void onDataChanged() {
        super.onDataChanged();
    }

    @Override
    public void onError(@NonNull DatabaseError error) {
        super.onError(error);
        error.toException().printStackTrace();
    }


    @Override
    protected void onBindViewHolder(@NonNull myviewholder holder, int position, @NonNull final model_subcategory model) {
        holder.nametext.setText(model.getPname());
        Glide.with(holder.img1.getContext()).load(model.getImage()).into(holder.img1);
        holder.status.setText(model.getStatus());

        DatabaseReference rootref = FirebaseDatabase.getInstance().getReference().child("Products").child("Fruits").child(model.getPname());

       holder.approve.setOnClickListener(new View.OnClickListener() {
           @Override
           public void onClick(View v) {
               HashMap<String, Object> productMap = new HashMap<>();
               productMap.put("status", "Approved");
               rootref.updateChildren(productMap);
           }
       });


        holder.reject.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                HashMap<String, Object> productMap = new HashMap<>();
                productMap.put("status", "Not Approved");
                rootref.updateChildren(productMap);
            }
        });
    }

    @NonNull
    @Override
    public myviewholder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
        View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.adminrowdesign, parent, false);
        return new myviewholder(view);
    }

    public class myviewholder extends RecyclerView.ViewHolder {
        ImageView img1;
        TextView nametext;
        Button approve,reject;
        TextView status;
        public myviewholder(@NonNull View itemView) {
            super(itemView);
            approve = itemView.findViewById(R.id.approve);
            reject = itemView.findViewById(R.id.reject);
            img1 = itemView.findViewById(R.id.img1);
            nametext = itemView.findViewById(R.id.nametext);
            status = itemView.findViewById(R.id.status);

        }
    }

}
)
(dbfs:/FileStore/LiveMart/Admin/adminadapter.java,package com.example.oop_project.Main.Admin;

import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.EditText;
import android.widget.ImageView;
import android.widget.TextView;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;
import androidx.recyclerview.widget.RecyclerView;

import com.bumptech.glide.Glide;
import com.example.oop_project.Main.Customer.CustomerSubCategories;
import com.example.oop_project.Main.Customer.model_category;
import com.example.oop_project.R;
import com.firebase.ui.database.FirebaseRecyclerAdapter;
import com.firebase.ui.database.FirebaseRecyclerOptions;
import com.google.firebase.database.DatabaseError;

public class adminadapter extends FirebaseRecyclerAdapter<model_category, adminadapter.myviewholder> {

    public adminadapter(@NonNull FirebaseRecyclerOptions<model_category> options) {
        super(options);
    }

    @Override
    public void onDataChanged() {
        super.onDataChanged();
    }

    @Override
    public void onError(@NonNull DatabaseError error) {

        super.onError(error);
        error.toException().printStackTrace();
    }


    @Override
    protected void onBindViewHolder(@NonNull myviewholder holder, int position, @NonNull final model_category model) {


        holder.nametext.setText(model.getPname());
        Glide.with(holder.img1.getContext()).load(model.getImage()).into(holder.img1);
        holder.cutdisttext.setVisibility(View.INVISIBLE);
        holder.cutDist.setVisibility(View.INVISIBLE);
        holder.Quant.setVisibility(View.INVISIBLE);
        holder.Quanttext.setVisibility(View.INVISIBLE);
        Log.i("practi","diff"+(model.getPname()));

//        if(model.getPname().equals("Fruits")) {
//            holder.itemView.setVisibility(View.VISIBLE);
//            }
//            else{
//            holder.itemView.setVisibility(View.GONE);
//        }


        holder.itemView.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
//                CustomerSubCategories(model.getPname())
                Log.i("pract","diff"+(model.getPname()));
                AppCompatActivity activity=(AppCompatActivity)view.getContext();

                activity.getSupportFragmentManager().beginTransaction().replace(R.id.container,new Adminsub(model.getPname())).addToBackStack(null).commit();


            }
        });
    }

    @NonNull
    @Override
    public myviewholder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
        View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.singlerowdesign, parent, false);
        return new myviewholder(view);
    }

    public class myviewholder extends RecyclerView.ViewHolder {
        ImageView img1;
        TextView nametext;
        TextView cutdisttext,Quant;
        EditText cutDist,Quanttext;

        public myviewholder(@NonNull View itemView) {
            super(itemView);


            Quanttext = itemView.findViewById(R.id.qtyText);
            Quant = itemView.findViewById(R.id.textView5);
            cutdisttext = itemView.findViewById(R.id.cutDisttext);
            cutDist = itemView.findViewById(R.id.cutDist);
            img1 = itemView.findViewById(R.id.img1);
            nametext = itemView.findViewById(R.id.nametext);

        }
    }

}
)
(dbfs:/FileStore/LiveMart/AdminActivity.java,package com.example.oop_project.Main;

import androidx.appcompat.app.AppCompatActivity;

import android.os.Bundle;
import android.view.View;
import android.widget.Button;

import com.example.oop_project.Main.Admin.Admin;
import com.example.oop_project.Main.Admin.Adminsub;
import com.example.oop_project.Main.Customer.CustomerSubCategories;
import com.example.oop_project.R;

public class AdminActivity extends AppCompatActivity {
    Button admin;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_admin);
        admin = findViewById(R.id.adminButton);
        admin.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {

                AppCompatActivity activity=(AppCompatActivity)v.getContext();

                activity.getSupportFragmentManager().beginTransaction().replace(R.id.container,new Admin()).addToBackStack(null).commit();
            }
        });
    }
})
(dbfs:/FileStore/LiveMart/AlarmActivity.java,package com.example.oop_project.Main;

import android.content.Intent;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;

import androidx.appcompat.app.AppCompatActivity;
import androidx.recyclerview.widget.RecyclerView;


import com.example.oop_project.R;

import java.util.List;

public class AlarmActivity extends AppCompatActivity implements View.OnClickListener {
    Button createEvent;
    EventAdapter eventAdapter;
    RecyclerView recyclerview;
    DatabaseClass databaseClass;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_alarm);
        createEvent = findViewById(R.id.btn_createEvent);
        recyclerview = findViewById(R.id.recyclerview);
        createEvent.setOnClickListener(this);
        databaseClass = DatabaseClass.getDatabase(getApplicationContext());
    }

    @Override
    protected void onResume() {
        super.onResume();
        setAdapter();

    }

    private void setAdapter() {
        List<EntityClass> classList = databaseClass.EventDao().getAllData();
        eventAdapter = new EventAdapter(getApplicationContext(), classList);
        recyclerview.setAdapter(eventAdapter);
    }

    @Override
    public void onClick(View view) {
        if (view == createEvent) {
            goToCreateEventActivity();
        }
    }

    private void goToCreateEventActivity() {
        Intent intent = new Intent(getApplicationContext(), CreateEvent.class);
        startActivity(intent);
    }
})
(dbfs:/FileStore/LiveMart/AlarmBroadcast.java,package com.example.oop_project.Main;

import android.app.Notification;
import android.app.NotificationChannel;
import android.app.NotificationManager;
import android.app.PendingIntent;
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.os.Build;
import android.os.Bundle;
import android.widget.RemoteViews;

import androidx.core.app.NotificationCompat;

import com.example.oop_project.R;

public class AlarmBroadcast extends BroadcastReceiver {
    @Override
    public void onReceive(Context context, Intent intent) {
        Bundle bundle = intent.getExtras();
        String text = bundle.getString("event");
        String date = bundle.getString("date") + " " + bundle.getString("time");

        //Click on Notification

        Intent intent1 = new Intent(context, NotificationMessage.class);
        intent1.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);
        intent1.putExtra("message", text);
        //Notification Builder
        PendingIntent pendingIntent = PendingIntent.getActivity(context, 1, intent1, PendingIntent.FLAG_ONE_SHOT);
        NotificationManager notificationManager = (NotificationManager) context.getSystemService(Context.NOTIFICATION_SERVICE);
        NotificationCompat.Builder mBuilder = new NotificationCompat.Builder(context, "notify_001");

        RemoteViews contentView = new RemoteViews(context.getPackageName(), R.layout.notification_layout);
        contentView.setImageViewResource(R.id.image, R.mipmap.ic_launcher);
        PendingIntent pendingSwitchIntent = PendingIntent.getBroadcast(context, 0, intent, 0);
        contentView.setOnClickPendingIntent(R.id.flashButton, pendingSwitchIntent);
        contentView.setTextViewText(R.id.message, text);
        contentView.setTextViewText(R.id.date, date);
        mBuilder.setSmallIcon(R.drawable.ic_baseline_access_alarm_24);
        mBuilder.setAutoCancel(true);
        mBuilder.setOngoing(true);
        mBuilder.setPriority(Notification.PRIORITY_HIGH);
        mBuilder.setOnlyAlertOnce(true);
        mBuilder.build().flags = Notification.FLAG_NO_CLEAR | Notification.PRIORITY_HIGH;
        mBuilder.setContent(contentView);
        mBuilder.setContentIntent(pendingIntent);

        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {
            String channelId = "channel_id";
            NotificationChannel channel = new NotificationChannel(channelId, "channel name", NotificationManager.IMPORTANCE_HIGH);
            channel.enableVibration(true);
            notificationManager.createNotificationChannel(channel);
            mBuilder.setChannelId(channelId);
        }

        Notification notification = mBuilder.build();
        notificationManager.notify(1, notification);


    }
})
(dbfs:/FileStore/LiveMart/BootUpReceiver.java,package com.example.oop_project.Main;

import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;

public class BootUpReceiver extends BroadcastReceiver {
    @Override
    public void onReceive(Context context, Intent intent) {
        Intent intent1 = new Intent(context, MainActivity.class);
        intent1.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
        context.startActivity(intent1);
    }
})
(dbfs:/FileStore/LiveMart/CreateEvent.java,package com.example.oop_project.Main;

import android.app.AlarmManager;
import android.app.DatePickerDialog;
import android.app.PendingIntent;
import android.app.TimePickerDialog;
import android.content.Context;
import android.content.Intent;
import android.os.Bundle;
import android.speech.RecognizerIntent;
import android.view.View;
import android.widget.Button;
import android.widget.DatePicker;
import android.widget.EditText;
import android.widget.ImageView;
import android.widget.TimePicker;
import android.widget.Toast;

import androidx.annotation.Nullable;
import androidx.appcompat.app.AppCompatActivity;


import com.example.oop_project.R;

import java.text.DateFormat;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Date;

public class CreateEvent extends AppCompatActivity implements View.OnClickListener {
    Button btn_time, btn_date, btn_done;
    ImageView btn_record;
    EditText editext_message;
    String timeTonotify;
    DatabaseClass databaseClass;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_create_event);
        btn_record = findViewById(R.id.btn_record);
        btn_time = findViewById(R.id.btn_time);
        btn_date = findViewById(R.id.btn_date);
        btn_done = findViewById(R.id.btn_done);
        editext_message = findViewById(R.id.editext_message);
        btn_record.setOnClickListener(this);
        btn_time.setOnClickListener(this);
        btn_date.setOnClickListener(this);
        btn_done.setOnClickListener(this);
        databaseClass = DatabaseClass.getDatabase(getApplicationContext());

    }

    @Override
    public void onClick(View view) {
        if (view == btn_record) {
            recordSpeech();
        } else if (view == btn_time) {
            selectTime();
        } else if (view == btn_date) {
            selectDate();
        } else {
            submit();
        }
    }

    private void submit() {
        String text = editext_message.getText().toString().trim();
        if (text.isEmpty()) {
            Toast.makeText(this, "Please Enter or record the text", Toast.LENGTH_SHORT).show();
        } else {
            if (btn_time.getText().toString().equals("Select Time") || btn_date.getText().toString().equals("Select date")) {
                Toast.makeText(this, "Please select date and time", Toast.LENGTH_SHORT).show();
            } else {
                EntityClass entityClass = new EntityClass();
                String value = (editext_message.getText().toString().trim());
                String date = (btn_date.getText().toString().trim());
                String time = (btn_time.getText().toString().trim());
                entityClass.setEventdate(date);
                entityClass.setEventname(value);
                entityClass.setEventtime(time);
                databaseClass.EventDao().insertAll(entityClass);
                setAlarm(value, date, time);
            }
        }
    }

    private void selectTime() {
        Calendar calendar = Calendar.getInstance();
        int hour = calendar.get(Calendar.HOUR_OF_DAY);
        int minute = calendar.get(Calendar.MINUTE);
        TimePickerDialog timePickerDialog = new TimePickerDialog(this, new TimePickerDialog.OnTimeSetListener() {
            @Override
            public void onTimeSet(TimePicker timePicker, int i, int i1) {
                timeTonotify = i + ":" + i1;
                btn_time.setText(FormatTime(i, i1));
            }
        }, hour, minute, false);
        timePickerDialog.show();

    }

    private void selectDate() {
        Calendar calendar = Calendar.getInstance();
        int year = calendar.get(Calendar.YEAR);
        int month = calendar.get(Calendar.MONTH);
        int day = calendar.get(Calendar.DAY_OF_MONTH);
        DatePickerDialog datePickerDialog = new DatePickerDialog(this, new DatePickerDialog.OnDateSetListener() {
            @Override
            public void onDateSet(DatePicker datePicker, int year, int month, int day) {
                btn_date.setText(day + "-" + (month + 1) + "-" + year);
            }
        }, year, month, day);
        datePickerDialog.show();
    }

    public String FormatTime(int hour, int minute) {

        String time;
        time = "";
        String formattedMinute;

        if (minute / 10 == 0) {
            formattedMinute = "0" + minute;
        } else {
            formattedMinute = "" + minute;
        }


        if (hour == 0) {
            time = "12" + ":" + formattedMinute + " AM";
        } else if (hour < 12) {
            time = hour + ":" + formattedMinute + " AM";
        } else if (hour == 12) {
            time = "12" + ":" + formattedMinute + " PM";
        } else {
            int temp = hour - 12;
            time = temp + ":" + formattedMinute + " PM";
        }


        return time;
    }


    private void recordSpeech() {

        Intent intent = new Intent(RecognizerIntent.ACTION_RECOGNIZE_SPEECH);
        intent.putExtra(RecognizerIntent.EXTRA_LANGUAGE_MODEL, "en-US");
        try {

            startActivityForResult(intent, 1);
        } catch (Exception e) {
            Toast.makeText(this, "Your device does not support Speech recognizer", Toast.LENGTH_SHORT).show();
        }

    }

    @Override
    protected void onActivityResult(int requestCode, int resultCode, @Nullable Intent data) {
        super.onActivityResult(requestCode, resultCode, data);
        if (requestCode == 1) {
            if (resultCode == RESULT_OK && data != null) {
                ArrayList<String> text = data.getStringArrayListExtra(RecognizerIntent.EXTRA_RESULTS);
                editext_message.setText(text.get(0));
            }
        }

    }

    private void setAlarm(String text, String date, String time) {
        AlarmManager am = (AlarmManager) getSystemService(Context.ALARM_SERVICE);

        Intent intent = new Intent(getApplicationContext(), AlarmBroadcast.class);
        intent.putExtra("event", text);
        intent.putExtra("time", date);
        intent.putExtra("date", time);

        PendingIntent pendingIntent = PendingIntent.getBroadcast(getApplicationContext(), 0, intent, PendingIntent.FLAG_ONE_SHOT);
        String dateandtime = date + " " + timeTonotify;
        DateFormat formatter = new SimpleDateFormat("d-M-yyyy hh:mm");
        try {
            Date date1 = formatter.parse(dateandtime);
            am.set(AlarmManager.RTC_WAKEUP, date1.getTime(), pendingIntent);

        } catch (ParseException e) {
            e.printStackTrace();
        }

        finish();

    }
})
(dbfs:/FileStore/LiveMart/Customer/CartActivity.java,package com.example.oop_project.Main.Customer;

import android.os.Bundle;

import androidx.annotation.NonNull;
import androidx.fragment.app.Fragment;

import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;

import com.example.oop_project.R;
import com.google.firebase.database.DataSnapshot;
import com.google.firebase.database.DatabaseError;
import com.google.firebase.database.FirebaseDatabase;
import com.google.firebase.database.ValueEventListener;

import java.util.ArrayList;

public class CartActivity extends Fragment {



    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        // Inflate the layout for this fragment

        View view = inflater.inflate(R.layout.fragment_cart_activity, container, false);

        return view;


    }
})
(dbfs:/FileStore/LiveMart/Customer/CartAdapter.java,package com.example.oop_project.Main.Customer;

import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.TextView;

import androidx.annotation.NonNull;
import androidx.recyclerview.widget.RecyclerView;

import com.example.oop_project.R;
import com.example.oop_project.Main.Retailer.Orders_sub;
import com.firebase.ui.database.FirebaseRecyclerAdapter;
import com.firebase.ui.database.FirebaseRecyclerOptions;
import com.google.firebase.database.DatabaseError;

public class CartAdapter extends FirebaseRecyclerAdapter<Orders_sub, CartAdapter.myviewholder> {
    boolean t;
    public CartAdapter(@NonNull FirebaseRecyclerOptions<Orders_sub> options) {
        super(options);
    }

    @Override
    public void onDataChanged() {
        super.onDataChanged();
    }

    @Override
    public void onError(@NonNull DatabaseError error) {
        super.onError(error);
        error.toException().printStackTrace();
    }


    @Override
    protected void onBindViewHolder(@NonNull myviewholder holder, int position, @NonNull final Orders_sub model) {

        holder.shop.setText("Customer Name: ");
        holder.pname.setText(model.getPname());
        holder.custname.setText(model.getShop());
        holder.cost.setText(model.getCost());
        holder.ddate.setText(model.getDdate());
        holder.dname.setText(model.getDname());
        holder.dnum.setText(model.getDnumber());
        holder.dqty.setText(model.getQuantity());
        holder.status.setText(model.getStatus());
    }

    @NonNull
    @Override
    public myviewholder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
        View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.transaction_info, parent, false);
        return new myviewholder(view);
    }

    public class myviewholder extends RecyclerView.ViewHolder {
        TextView custname,cost,ddate,dname,dnum,dqty,status,pname,shop;
        public myviewholder(@NonNull View view) {
            super(view);
            shop = (TextView) view.findViewById(R.id.Custtitle);
            pname = (TextView) view.findViewById(R.id.Titletext);
            custname = (TextView) view.findViewById(R.id.CustName);
            cost = (TextView) view.findViewById(R.id.cost_trans);
            ddate = (TextView) view.findViewById(R.id.deliverydate);
            dname = (TextView) view.findViewById(R.id.deliveryexec);
            dnum = (TextView) view.findViewById(R.id.deliverynum);
            dqty = (TextView) view.findViewById(R.id.quantity_trans);
            status = (TextView) view.findViewById(R.id.stat_trans);
        }
    }

}
)
(dbfs:/FileStore/LiveMart/Customer/CustomerCart.java,package com.example.oop_project.Main.Customer;

import android.content.Intent;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.AdapterView;
import android.widget.ArrayAdapter;
import android.widget.ListView;

import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.appcompat.app.AppCompatActivity;
import androidx.fragment.app.Fragment;

import com.example.oop_project.R;

import java.util.ArrayList;

public class CustomerCart extends Fragment implements AdapterView.OnItemClickListener{
    ArrayList<String> Keys = new ArrayList<>();
    boolean t;
    @Override
    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {
        super.onViewCreated(view, savedInstanceState);
        ListView listview = view.findViewById(R.id.listView);

        ArrayAdapter<String> adapter= new ArrayAdapter<>(getActivity(),R.layout.row,R.id.maintransview,Keys);
        listview.setAdapter(adapter);
        listview.setOnItemClickListener(this);
    }

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        View view = inflater.inflate(R.layout.transaction_layout, container, false);
        return view;
    }
    public CustomerCart(ArrayList<String> Keys) {
        this.Keys=Keys;
    }

    @Override
    public void onItemClick(AdapterView<?> parent, View view, int position, long id) {
        String selectedFromList = (String) (parent.getItemAtPosition(position));
        AppCompatActivity activity = (AppCompatActivity) view.getContext();
        activity.getSupportFragmentManager().beginTransaction().replace(R.id.container, new CustomerCart_sub(selectedFromList)).addToBackStack(null).commit();
    }
}
)
(dbfs:/FileStore/LiveMart/Customer/CustomerCart_sub.java,package com.example.oop_project.Main.Customer;

import android.content.Context;
import android.content.SharedPreferences;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;

import androidx.appcompat.app.AppCompatActivity;
import androidx.fragment.app.Fragment;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;

import com.example.oop_project.Main.FragmentContent;
import com.example.oop_project.R;
import com.example.oop_project.Main.Retailer.Orders_sub;
import com.firebase.ui.database.FirebaseRecyclerOptions;
import com.google.firebase.database.FirebaseDatabase;

public class CustomerCart_sub extends Fragment {

    String pname;

    RecyclerView recview;
    CartAdapter adapter;

    SharedPreferences sh = getActivity().getSharedPreferences("MySharedPref", Context.MODE_PRIVATE);

                    // The value will be default as empty string because for
// the very first time when the app is opened, there is nothing to show
                    String p_username = sh.getString("username", "Macha");
                    String p_usertype = sh.getString("usertype", "Customer");
    public CustomerCart_sub() {

    }

    public CustomerCart_sub(String pname) {
        this.pname=pname;

    }

    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
    }

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {

        View view=inflater.inflate(R.layout.categories2, container, false);

        recview = (RecyclerView) view.findViewById(R.id.recview2);
        recview.setLayoutManager(new LinearLayoutManager(getContext()));

        FirebaseRecyclerOptions<Orders_sub> options =
                new FirebaseRecyclerOptions.Builder<Orders_sub>()
                        .setQuery(FirebaseDatabase.getInstance().getReference().child("Cart").child("Customer").child(p_username).child(pname), Orders_sub.class)
                        .build();
        adapter = new CartAdapter(options);
        recview.setAdapter(adapter);
        return  view;
    }

    public void onBackPressed()
    {
        AppCompatActivity activity=(AppCompatActivity)getContext();
        activity.getSupportFragmentManager().beginTransaction().replace(R.id.container,new FragmentContent()).addToBackStack(null).commit();

    }

    @Override
    public void onStart() {
        super.onStart();
        adapter.startListening();
    }

    @Override
    public void onStop() {
        super.onStop();
        adapter.stopListening();
    }
})
(dbfs:/FileStore/LiveMart/Customer/CustomerCategories.java,package com.example.oop_project.Main.Customer;

import android.content.Intent;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;

import androidx.fragment.app.Fragment;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;

import com.example.oop_project.R;
import com.firebase.ui.database.FirebaseRecyclerOptions;
import com.google.firebase.database.FirebaseDatabase;

public class CustomerCategories extends Fragment {
    private static final String ARG_PARAM1 = "param1";
    private static final String ARG_PARAM2 = "param2";

    private String mParam1;
    private String mParam2;
    RecyclerView recview;
    myadapterCustomerCategory adapter;

    public CustomerCategories() {

    }

    public static CustomerCategories newInstance(String param1, String param2) {
        CustomerCategories fragment = new CustomerCategories();
        Bundle args = new Bundle();
        args.putString(ARG_PARAM1, param1);
        args.putString(ARG_PARAM2, param2);
        fragment.setArguments(args);
        return fragment;
    }

    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        if (getArguments() != null) {
            mParam1 = getArguments().getString(ARG_PARAM1);
            mParam2 = getArguments().getString(ARG_PARAM2);
        }
    }

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {

        View view = inflater.inflate(R.layout.categories, container, false);

        recview = (RecyclerView) view.findViewById(R.id.recview);
        recview.setLayoutManager(new LinearLayoutManager(getContext()));

        FirebaseRecyclerOptions<model_category> options =
                new FirebaseRecyclerOptions.Builder<model_category>()
                        .setQuery(FirebaseDatabase.getInstance().getReference().child("Products").child("Categories"), model_category.class)
                        .build();

        adapter = new myadapterCustomerCategory(options);
        recview.setAdapter(adapter);



        return view;
    }


    @Override
    public void onStart() {
        super.onStart();
        adapter.startListening();
    }

    @Override
    public void onStop() {
        super.onStop();
        adapter.stopListening();
    }
}
)
(dbfs:/FileStore/LiveMart/Customer/CustomerOrders.java,package com.example.oop_project.Main.Customer;

import android.content.Intent;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.AdapterView;
import android.widget.ArrayAdapter;
import android.widget.Button;
import android.widget.ListView;

import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.appcompat.app.AppCompatActivity;
import androidx.fragment.app.Fragment;

import com.example.oop_project.Main.AlarmActivity;
import com.example.oop_project.R;

import java.util.ArrayList;

public class CustomerOrders extends Fragment implements AdapterView.OnItemClickListener{
    ArrayList<String> Keys = new ArrayList<>();
    String pname;

    @Override
    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {
        super.onViewCreated(view, savedInstanceState);
        ListView listview = view.findViewById(R.id.listView);

        ArrayAdapter<String> adapter= new ArrayAdapter<>(getActivity(),R.layout.row,R.id.maintransview,Keys);
        listview.setAdapter(adapter);
        listview.setOnItemClickListener(this);
    }

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        View view = inflater.inflate(R.layout.transaction_layout, container, false);
        Button notifbtn = (Button) view.findViewById(R.id.notifbtn);
        notifbtn.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                Intent i = new Intent(getContext(), AlarmActivity.class);
                getContext().startActivity(i);
            }
        });
        return view;
    }
    public CustomerOrders(ArrayList<String> Keys, String pname) {
        this.Keys=Keys;
        this.pname=pname;
    }

    @Override
    public void onItemClick(AdapterView<?> parent, View view, int position, long id) {
        String selectedFromList = (String) (parent.getItemAtPosition(position));
        AppCompatActivity activity=(AppCompatActivity)view.getContext();
        activity.getSupportFragmentManager().beginTransaction().replace(R.id.container,new CustomerOrders_sub(selectedFromList,pname)).addToBackStack(null).commit();
    }
}
)
(dbfs:/FileStore/LiveMart/Customer/CustomerOrders_sub.java,package com.example.oop_project.Main.Customer;

import android.content.Intent;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Button;

import androidx.appcompat.app.AppCompatActivity;
import androidx.fragment.app.Fragment;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;

import com.example.oop_project.Main.AlarmActivity;
import com.example.oop_project.Main.FragmentContent;
import com.example.oop_project.R;
import com.firebase.ui.database.FirebaseRecyclerOptions;
import com.google.firebase.database.FirebaseDatabase;

public class CustomerOrders_sub extends Fragment {

    String pname,custname;
    RecyclerView recview;
    OrderAdapter adapter;
    public CustomerOrders_sub() {

    }

    public CustomerOrders_sub(String pname,String custname) {
        this.pname=pname;
        this.custname =custname;

    }

    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
    }

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {

        View view=inflater.inflate(R.layout.categories2, container, false);

        recview = (RecyclerView) view.findViewById(R.id.recview2);
        recview.setLayoutManager(new LinearLayoutManager(getContext()));

        FirebaseRecyclerOptions<TransModel_sub> options =
                new FirebaseRecyclerOptions.Builder<TransModel_sub>()
                        .setQuery(FirebaseDatabase.getInstance().getReference().child("Cart").child("Customer").child(custname).child(pname), TransModel_sub.class)
                        .build();
        adapter = new OrderAdapter(options,getContext());
        recview.setAdapter(adapter);
        return  view;
    }

    public void onBackPressed()
    {
        AppCompatActivity activity=(AppCompatActivity)getContext();
        activity.getSupportFragmentManager().beginTransaction().replace(R.id.container,new FragmentContent()).addToBackStack(null).commit();

    }

    @Override
    public void onStart() {
        super.onStart();
        adapter.startListening();
    }

    @Override
    public void onStop() {
        super.onStop();
        adapter.stopListening();
    }
})
(dbfs:/FileStore/LiveMart/Customer/CustomerShopList.java,package com.example.oop_project.Main.Customer;

import android.os.Bundle;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.EditText;

import androidx.appcompat.app.AppCompatActivity;
import androidx.fragment.app.Fragment;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;

import com.example.oop_project.R;
import com.firebase.ui.database.FirebaseRecyclerOptions;
import com.google.firebase.database.DatabaseReference;
import com.google.firebase.database.FirebaseDatabase;
import com.google.firebase.database.Query;

public class CustomerShopList extends Fragment{
    double cutDist=1000;
    private static final String ARG_PARAM1 = "param1";
    private static final String ARG_PARAM2 = "param2";

    private String mParam1;
    private String mParam2;
    public int quantity;
    public double cutoffDistance;
    String catname,pname;
    RecyclerView recview1;
    Shopadapter adapter;
    EditText cutoffDist;
    public CustomerShopList() {

    }

    public CustomerShopList(String catname, String pname,double cutDistance,int qty) {
        this.cutoffDistance = cutDistance;
        this.catname = catname;
        this.pname = pname;
        this.quantity = qty;
    }

    public static CustomerShopList newInstance(String param1, String param2) {
        CustomerShopList fragment = new CustomerShopList();
        Bundle args = new Bundle();
        args.putString(ARG_PARAM1, param1);
        args.putString(ARG_PARAM2, param2);
        fragment.setArguments(args);
        return fragment;
    }

    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        if (getArguments() != null) {
            mParam1 = getArguments().getString(ARG_PARAM1).trim();
            mParam2 = getArguments().getString(ARG_PARAM2).trim();
        }

    }

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        View view = inflater.inflate(R.layout.activity_shop_filter, container, false);
        recview1 = (RecyclerView) view.findViewById(R.id.rcycler);
        recview1.setLayoutManager(new LinearLayoutManager(getContext()));
        Log.i("Mine dis", "pname:" + pname);
        Log.i("Mine dis", "catname:" + catname);

        DatabaseReference rootref = FirebaseDatabase.getInstance().getReference();
        Query query = rootref.child("Quantity").child(catname).child(pname).child("Retailer");
        //pname = Fruits

        FirebaseRecyclerOptions<model_shop> options =
                new FirebaseRecyclerOptions.Builder<model_shop>()
                        .setQuery(query, model_shop.class)
                        .build();

        adapter = new Shopadapter(options,getContext(),  catname , pname,cutoffDistance,quantity);
        recview1.setAdapter(adapter);

        return view;
    }

    public void onBackPressed() {
        AppCompatActivity activity = (AppCompatActivity) getContext();
        activity.getSupportFragmentManager().beginTransaction().replace(R.id.container, new CustomerSubCategories()).addToBackStack(null).commit();

    }

    @Override
    public void onStart() {
        super.onStart();
        adapter.startListening();

    }

    @Override
    public void onStop() {
        super.onStop();
        adapter.stopListening();
    }
})
(dbfs:/FileStore/LiveMart/Customer/CustomerSubCategories.java,package com.example.oop_project.Main.Customer;

import android.os.Bundle;

import androidx.appcompat.app.AppCompatActivity;
import androidx.fragment.app.Fragment;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;

import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;

import com.example.oop_project.R;
import com.firebase.ui.database.FirebaseRecyclerOptions;
import com.google.firebase.database.FirebaseDatabase;

public class    CustomerSubCategories extends Fragment {

    private static final String ARG_PARAM1 = "param1";
    private static final String ARG_PARAM2 = "param2";

    private String mParam1;
    private String mParam2;
    String pname;
    RecyclerView recview;
    adapter_sub adapter;
    public CustomerSubCategories() {

    }

    public CustomerSubCategories(String pname) {
        this.pname=pname;

    }

    public static CustomerSubCategories newInstance(String param1, String param2) {
        CustomerSubCategories fragment = new CustomerSubCategories();
        Bundle args = new Bundle();
        args.putString(ARG_PARAM1, param1);
        args.putString(ARG_PARAM2, param2);
        fragment.setArguments(args);
        return fragment;
    }

    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        if (getArguments() != null) {
            mParam1 = getArguments().getString(ARG_PARAM1);
            mParam2 = getArguments().getString(ARG_PARAM2);
        }
    }

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {

        View view=inflater.inflate(R.layout.categories2, container, false);

        recview = (RecyclerView) view.findViewById(R.id.recview2);
        recview.setLayoutManager(new LinearLayoutManager(getContext()));

        FirebaseRecyclerOptions<model_subcategory> options =
                new FirebaseRecyclerOptions.Builder<model_subcategory>()
                        .setQuery(FirebaseDatabase.getInstance().getReference().child("Products").child(pname).orderByChild("status").equalTo("Approved"), model_subcategory.class)
                        .build();
        adapter = new adapter_sub(options,pname);
        recview.setAdapter(adapter);


        return  view;
    }

    public void onBackPressed()
    {
        AppCompatActivity activity=(AppCompatActivity)getContext();
        activity.getSupportFragmentManager().beginTransaction().replace(R.id.container,new CustomerCategories()).addToBackStack(null).commit();

    }

    @Override
    public void onStart() {
        super.onStart();
        adapter.startListening();
    }

    @Override
    public void onStop() {
        super.onStop();
        adapter.stopListening();
    }
})
(dbfs:/FileStore/LiveMart/Customer/OrderAdapter.java,package com.example.oop_project.Main.Customer;

import android.content.Context;
import android.content.Intent;
import android.content.SharedPreferences;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Button;
import android.widget.TextView;
import android.widget.Toast;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;
import androidx.recyclerview.widget.RecyclerView;
import com.example.oop_project.Main.FeedbackFrag;
import com.example.oop_project.Main.AlarmActivity;
import com.example.oop_project.Main.MainActivity;
import com.example.oop_project.Main.NavigationBar;
import com.example.oop_project.R;
import com.firebase.ui.database.FirebaseRecyclerAdapter;
import com.firebase.ui.database.FirebaseRecyclerOptions;
import com.google.firebase.database.DataSnapshot;
import com.google.firebase.database.DatabaseError;
import com.google.firebase.database.DatabaseReference;
import com.google.firebase.database.FirebaseDatabase;
import com.google.firebase.database.ValueEventListener;

public class OrderAdapter extends FirebaseRecyclerAdapter<TransModel_sub, OrderAdapter.myviewholder> {

    public  String cust_uid = "M";
    Context ct;
    public OrderAdapter(@NonNull FirebaseRecyclerOptions<TransModel_sub> options,Context c) {
        super(options);
        ct = c;
    }

    @Override
    public void onDataChanged() {
        super.onDataChanged();
    }

    @Override
    public void onError(@NonNull DatabaseError error) {
        super.onError(error);
        error.toException().printStackTrace();
    }


    @Override
    protected void onBindViewHolder(@NonNull myviewholder holder, int position, @NonNull final TransModel_sub model) {
        SharedPreferences sh = ct.getSharedPreferences("MySharedPref", Context.MODE_PRIVATE);
        String p_username = sh.getString("username", "Macha");
        String p_usertype = sh.getString("usertype", "Customer");

        holder.shop.setText("Shop Name: ");
        holder.pname.setText(model.getPname());
        holder.custname.setText(model.getShop());
        holder.cost.setText(model.getCost());
        holder.ddate.setText(model.getDdate());
        holder.dname.setText(model.getDname());
        holder.dnum.setText(model.getDnumber());
        holder.dqty.setText(model.getQuantity());
        holder.status.setText(model.getStatus());
        holder.bt.setVisibility(View.VISIBLE);
        holder.bt.setOnClickListener(new View.OnClickListener(){
            @Override
            //On click function
            public void onClick(View view) {
                //holder.bt.setVisibility(View.INVISIBLE);
                AppCompatActivity activity=(AppCompatActivity)view.getContext();
                activity.getSupportFragmentManager().beginTransaction().replace(R.id.container,new FeedbackFrag(p_usertype,p_username,model.getPname(),model.getShop())).addToBackStack(null).commit();
            }
        });
        holder.codbtn.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                holder.offbtn.setVisibility(View.INVISIBLE);

                String date = model.getDdate();
                Toast.makeText(ct,"The order will be delivered on " + date,Toast.LENGTH_SHORT).show();

            }
        });
        holder.offbtn.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                holder.codbtn.setVisibility(View.INVISIBLE);
                Intent i = new Intent(ct,AlarmActivity.class);
                ct.startActivity(i);

            }
        });
    }

    @NonNull
    @Override
    public myviewholder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
        View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.transaction_info, parent, false);
        return new myviewholder(view);
    }



    public class myviewholder extends RecyclerView.ViewHolder {
        TextView custname,cost,ddate,dname,dnum,dqty,status,pname,shop;
        Button bt;
        Button codbtn,offbtn;
        public myviewholder(@NonNull View view) {
            super(view);
            bt = (Button) view.findViewById(R.id.addfeedbacks);
            shop = (TextView) view.findViewById(R.id.Custtitle);
            pname = (TextView) view.findViewById(R.id.Titletext);
            custname = (TextView) view.findViewById(R.id.CustName);
            cost = (TextView) view.findViewById(R.id.cost_trans);
            ddate = (TextView) view.findViewById(R.id.deliverydate);
            dname = (TextView) view.findViewById(R.id.deliveryexec);
            dnum = (TextView) view.findViewById(R.id.deliverynum);
            dqty = (TextView) view.findViewById(R.id.quantity_trans);
            status = (TextView) view.findViewById(R.id.stat_trans);
            codbtn = (Button) view.findViewById(R.id.codbutton);
            offbtn = (Button) view.findViewById(R.id.offlinetransact);

        }
    }

})
(dbfs:/FileStore/LiveMart/Customer/Shopadapter.java,package com.example.oop_project.Main.Customer;

import android.content.Context;
import android.content.SharedPreferences;
import android.util.Log;

import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Button;
import android.widget.TextView;
import android.widget.Toast;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;
import androidx.fragment.app.FragmentManager;
import androidx.fragment.app.FragmentTransaction;
import androidx.recyclerview.widget.RecyclerView;

import com.example.oop_project.Main.FeedbackDisplay;
import com.example.oop_project.Main.FeedbackFrag;
import com.example.oop_project.Main.Retailer.RetailerTrans;
import com.example.oop_project.R;
import com.firebase.ui.database.FirebaseRecyclerAdapter;
import com.firebase.ui.database.FirebaseRecyclerOptions;
import com.google.firebase.database.DataSnapshot;
import com.google.firebase.database.DatabaseError;
import com.google.firebase.database.DatabaseReference;
import com.google.firebase.database.FirebaseDatabase;
import com.google.firebase.database.ValueEventListener;
import com.rey.material.BuildConfig;

import java.text.DecimalFormat;
import java.util.HashMap;
import java.util.Map;


public class Shopadapter extends FirebaseRecyclerAdapter<model_shop, Shopadapter.myviewholder>  {
    public String arg_cat,arg_pname,p_username,p_usertype, dist_temp,parent_usertype;
    public double cutoffDist;
    public int quantityDemand;
    public String uid;
    public String source;
    private FragmentManager mFragmentManager;
    public String fbtext="NO";
    Context context;
    // category , product name


    public Shopadapter(@NonNull FirebaseRecyclerOptions<model_shop> options, Context context, String catname , String pname,double cutDist,int quantity) {
        super(options);
        SharedPreferences sh = context.getSharedPreferences("MySharedPref", Context.MODE_PRIVATE);

        // The value will be default as empty string because for
// the very first time when the app is opened, there is nothing to show
        p_username  = sh.getString("username", "Macha");
        p_usertype  = sh.getString("usertype", "Customer");
        arg_cat=catname;
        arg_pname=pname;
        cutoffDist = cutDist;
        quantityDemand = quantity;
        this.context=context;

    }

    @Override
    public void onDataChanged() {
        super.onDataChanged();
    }

    @Override
    public void onError(@NonNull DatabaseError error) {
        super.onError(error);
        error.toException().printStackTrace();
    }
    private double distance(double lat1, double lon1, double lat2, double lon2) {
        double theta = lon1 - lon2;
        double dist = Math.sin(deg2rad(lat1))
                * Math.sin(deg2rad(lat2))
                + Math.cos(deg2rad(lat1))
                * Math.cos(deg2rad(lat2))
                * Math.cos(deg2rad(theta));
        dist = Math.acos(dist);
        dist = rad2deg(dist);
        dist = dist * 60 * 1.1515;
        return (dist/1000);

    }
    private double deg2rad(double deg) {
        return (deg * Math.PI / 180.0);
    }

    private double rad2deg(double rad) {
        return (rad * 180.0 / Math.PI);
    }
    @Override
    protected void onBindViewHolder(@NonNull myviewholder holder, int position, @NonNull final model_shop model) {
        Log.i("memes",arg_pname);
        Log.i("memes",p_username);
        Log.i("memes",p_usertype);
        Log.i("miccheck",fbtext);
        holder.shopname.setText(model.getRname());
        holder.qty.setText(model.getQuantity());
        holder.rate.setText(model.getPrice());
        if(quantityDemand != 0) {
            holder.tc.setText(Float.toString(Float.parseFloat(model.getPrice()) *quantityDemand));
        }
        else {
            holder.tc.setError("Please enter quantity!");
        }

        final FirebaseDatabase database = FirebaseDatabase.getInstance();
        DatabaseReference dbref = database.getReference().child("User");
        DatabaseReference db = FirebaseDatabase.getInstance().getReference();
        holder.b2.setOnClickListener(new View.OnClickListener(){
            @Override
            //On click function
            public void onClick(View view) {
                if(p_usertype.equals("Customer")){
                    source = "Retailer";
                }else if(p_usertype.equals("Retailer")){
                    source = "Wholesaler";
                }
                db.child("Feedback").child(source).child(model.getRname()).child(arg_pname).child(p_username).addValueEventListener(new ValueEventListener() {
                    @Override
                    public void onDataChange(DataSnapshot snapshot) {
                        if(snapshot.exists()) {
                            String retname=model.getRname();

                            fbtext = "By "+p_username+": \n"+snapshot.child("feedback").getValue().toString();

                            //db.child("Cart").child("Customer").child("Macha").child(uid).child(arg_pname).setValue(map);

                        }else{
                            fbtext = "NO FEEDBACK FOR THIS ITEM YET";
                        }
                        AppCompatActivity activity=(AppCompatActivity)view.getContext();
                        activity.getSupportFragmentManager().beginTransaction().replace(R.id.container,new FeedbackDisplay(fbtext)).addToBackStack(null).commit();

                    }

                    @Override
                    public void onCancelled(DatabaseError databaseError) {

                    }
                });

            }
        });

        holder.b1.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {


                int q = quantityDemand;
                if(p_usertype.equals("Customer")) {
                    dbref.addValueEventListener(new ValueEventListener() {
                        @Override
                        public void onDataChange(DataSnapshot snapshot) {
                            if(snapshot.exists()) {
                                String shop_name = (String) holder.shopname.getText();
                                uid = snapshot.child("Customer").child(p_username).child("Details").child("UID").getValue().toString();
                                Log.i("dei",uid.toString());
                                Map<String, Object> map = new HashMap<>();
                                map.put("pname", arg_pname);
                                map.put("cost", holder.tc.getText());
                                map.put("quantity", String.valueOf(quantityDemand));
                                map.put("shop", holder.shopname.getText());
                                map.put("dname", "daboi");
                                map.put("ddate", "1/6/21");
                                Log.i("Brux","kdnsk");
                                map.put("dnumber", "67564");
                                map.put("status", "Approved");
                                DatabaseReference db = FirebaseDatabase.getInstance().getReference();
                                db.child("Cart").child("Customer").child(p_username).child(uid).child(arg_pname).updateChildren(map);



                                Map<String, Object> mapa = new HashMap<>();
                                mapa.put("pname", arg_pname);
                                mapa.put("cost", holder.tc.getText());
                                mapa.put("quantity", String.valueOf(quantityDemand));
                                mapa.put("username", p_username);
                                mapa.put("dname", "daboi");
                                mapa.put("ddate", "1/6/21");
                                Log.i("Brux","kdnsk");
                                mapa.put("dnumber", "67564");
                                mapa.put("status", "Approved");
                                DatabaseReference dba = FirebaseDatabase.getInstance().getReference();

                                dba.child("Transaction").child("Retailer").child(shop_name).child(uid).child(arg_pname).updateChildren(mapa);

                                Toast.makeText(context, arg_pname+" was added to "+uid, Toast.LENGTH_SHORT).show();





                                //db.child("Cart").child("Customer").child("Macha").child(uid).child(arg_pname).setValue(map);

                            }

                        }

                        @Override
                        public void onCancelled(DatabaseError databaseError) {

                        }
                    });

                }

            }
        });
        dbref.addValueEventListener(new ValueEventListener() {
            @Override
            public void onDataChange(DataSnapshot snapshot) {
                if(snapshot.exists()){
                    String str1 = snapshot.child(p_usertype).child(p_username).child("Details").child("latitude").getValue().toString();
                    Log.e("memes", str1);
                    String str2= snapshot.child(p_usertype).child(p_username).child("Details").child("longitude").getValue().toString();
                    Log.e("memes", str2);
                    Log.i("status","random");
                    if(p_usertype.equals("Customer")){
                        parent_usertype="Retailer";
                    }else if(p_usertype.equals("Retailer")){
                        parent_usertype="Wholesaler";
                    }

                    String str3 = snapshot.child(parent_usertype).child(model.getRname()).child("Details").child("latitude").getValue().toString();
                    String str4 = snapshot.child(parent_usertype).child(model.getRname()).child("Details").child("longitude").getValue().toString();
                    double lat1,lat2,lon1,lon2;
                    lat1 = Double.parseDouble(str1);
                    lat2 = Double.parseDouble(str3);
                    lon1 = Double.parseDouble(str2);
                    lon2 = Double.parseDouble(str4);
                    String str = new DecimalFormat("#.00#").format(distance(lat1,lon1,lat2,lon2));
                    holder.dist.setText(str);
                    double activeDist = Double.parseDouble(str);
                    int qtyPresent = (int) Double.parseDouble(String.valueOf(holder.qty.getText()));
                    if(activeDist>cutoffDist){
                        holder.itemView.setVisibility(View.INVISIBLE);
                        Log.i("Dist","DS1 does not exist");
                    }
                    else {
                        holder.itemView.setVisibility(View.VISIBLE);
                    }
                    if(quantityDemand>qtyPresent){
                        holder.dist.setVisibility(View.INVISIBLE);
                        holder.rate.setVisibility(View.INVISIBLE);
                        holder.r.setVisibility(View.INVISIBLE);
                        holder.b1.setVisibility(View.INVISIBLE);
                        holder.b2.setVisibility(View.INVISIBLE);
                        holder.tc.setVisibility(View.INVISIBLE);

                        holder.t16.setVisibility(View.INVISIBLE);
                        holder.t21.setVisibility(View.INVISIBLE);
                        holder.sub.setVisibility(View.INVISIBLE);

                        holder.qty.setText("LOW on STOCK, return on 20th May!");
                    }
                }else{
                    Log.i("memes","DS1 does not exist");
                }

            }

            @Override
            public void onCancelled(DatabaseError databaseError) {

            }
        });



////        lat2 = Double.parseDouble(String.valueOf(database.getReference().child("User").child("Retailer").child(model.getRname()).child("Details").child("latitude").get()));
////        lon2 = Double.parseDouble(String.valueOf(database.getReference().child("User").child("Retailer").child(model.getRname()).child("Details").child("longitude").get()));
////        Log.e("distance: ", Double.toString(distance(lat1,lon1,lat2,lon2)));





        // to retrieve the coordinates from the user
        // retrieve coordinates from the shop
        // calculate distance



        //display details


        FirebaseDatabase.getInstance().getReference().child("Quantity").child(arg_cat).child(arg_pname);







        //Glide.with(holder.img1.getContext()).load().into(holder.img1);
        //add text and image based on layout ani designs
//        holder.img1.setOnClickListener(new View.OnClickListener() {
//            @Override
//            public void onClick(View view) {
//                AppCompatActivity activity=(AppCompatActivity)view.getContext();
//                activity.getSupportFragmentManager().beginTransaction().replace(R.id.container,new CustomerShopList()).addToBackStack(null).commit();
//            }
//        });
    }

    @NonNull
    @Override
    public myviewholder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
        View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.filter_row, parent, false);
        return new myviewholder(view);
    }

    public class myviewholder extends RecyclerView.ViewHolder {
        //modify this based on what ani designs
        TextView shopname,qty,rate,tc,dist,r;
        Button b1,b2,bt;
        TextView t16,t21,sub;

        public myviewholder(@NonNull View itemView) {
            super(itemView);

            this.itemView.getContext();
            int a =1;


            shopname = itemView.findViewById(R.id.shopnameTV);
            qty = itemView.findViewById(R.id.qtyTV);
            rate = itemView.findViewById(R.id.rateTV);
            tc = itemView.findViewById(R.id.totalcostTV);
            dist = itemView.findViewById(R.id.distTV);
            b1 = itemView.findViewById(R.id.addtocartbtn);
            b2 = itemView.findViewById(R.id.feedbackbtn);
            r = itemView.findViewById(R.id.retailer_sub_name);
            t16 = itemView.findViewById(R.id.textView16);
            t21 = itemView.findViewById(R.id.textView21);
            sub = itemView.findViewById(R.id.retailer_sub_name);




        }
    }
}

)
(dbfs:/FileStore/LiveMart/Customer/TransModel_sub.java,package com.example.oop_project.Main.Customer;

public class TransModel_sub {
    String cost,ddate,dname,dnumber,pname,quantity,status,shop;


    public TransModel_sub() {
    }

    public TransModel_sub(String cost, String ddate, String dname, String dnumber, String pname, String quantity, String status, String shop) {
        this.cost = cost;
        this.pname = pname;
        this.quantity=quantity;
        this.shop=shop;
        this.ddate=ddate;
        this.dname=dname;
        this.dnumber=dnumber;
        this.status=status;
    }

    public String getCost() {
        return cost;
    }

    public void setCost(String cost) {
        this.cost = cost;
    }

    public String getDdate() {
        return ddate;
    }

    public void setDdate(String ddate) {
        this.ddate = ddate;
    }

    public String getDname() {
        return dname;
    }

    public void setDname(String dname) {
        this.dname = dname;
    }

    public String getDnumber() {
        return dnumber;
    }

    public void setDnumber(String dnumber) {
        this.dnumber = dnumber;
    }

    public String getPname() {
        return pname;
    }

    public void setPname(String pname) {
        this.pname = pname;
    }

    public String getQuantity() {
        return quantity;
    }

    public void setQuantity(String quantity) {
        this.quantity = quantity;
    }

    public String getStatus() {
        return status;
    }

    public void setStatus(String status) {
        this.status = status;
    }

    public String getShop() {
        return shop;
    }

    public void setShop(String shop) {
        this.shop = shop;
    }
}
)
(dbfs:/FileStore/LiveMart/Customer/adapter_sub.java,package com.example.oop_project.Main.Customer;

import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Button;
import android.widget.EditText;
import android.widget.ImageView;
import android.widget.TextView;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;
import androidx.recyclerview.widget.RecyclerView;

import com.bumptech.glide.Glide;
import com.example.oop_project.R;
import com.firebase.ui.database.FirebaseRecyclerAdapter;
import com.firebase.ui.database.FirebaseRecyclerOptions;
import com.google.firebase.database.DatabaseError;

public class adapter_sub extends FirebaseRecyclerAdapter<model_subcategory, adapter_sub.myviewholder> {
    String catname;
    public adapter_sub(@NonNull FirebaseRecyclerOptions<model_subcategory> options,String category) {
        super(options);
        catname=category;
    }

    @Override
    public void onDataChanged() {
        super.onDataChanged();
    }

    @Override
    public void onError(@NonNull DatabaseError error) {
        super.onError(error);
        error.toException().printStackTrace();
    }


    @Override
    protected void onBindViewHolder(@NonNull myviewholder holder, int position, @NonNull final model_subcategory model) {
        holder.nametext.setText(model.getPname());
        Glide.with(holder.img1.getContext()).load(model.getImage()).into(holder.img1);
        holder.cutdisttext.setVisibility(View.VISIBLE);
        holder.cutDist.setVisibility(View.VISIBLE);
        holder.itemView.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                double cutDist=1000;
                int qty = 1;
                if(holder.cutDist.getText().length() != 0 ){
                    cutDist = Double.parseDouble(String.valueOf(holder.cutDist.getText()));

                }
                if(holder.qtyText.getText().length() !=0){
                qty = (int) Double.parseDouble(String.valueOf(holder.qtyText.getText()));}
                AppCompatActivity activity=(AppCompatActivity)view.getContext();
                activity.getSupportFragmentManager().beginTransaction().replace(R.id.container,new CustomerShopList(catname,model.getPname(),cutDist,qty)).addToBackStack(null).commit();
                Log.i("mine sub",catname +" hello "+model.getPname());
            }
        });
    }

    @NonNull
    @Override
    public myviewholder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
        View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.singlerowdesign, parent, false);
        return new myviewholder(view);
    }

    public class myviewholder extends RecyclerView.ViewHolder {
        ImageView img1;
        TextView nametext;
        TextView cutdisttext;
        EditText cutDist,qtyText;
        Button bt;
        public myviewholder(@NonNull View itemView) {
            super(itemView);
            cutdisttext = itemView.findViewById(R.id.cutDisttext);
            cutDist = itemView.findViewById(R.id.cutDist);
            img1 = itemView.findViewById(R.id.img1);
            nametext = itemView.findViewById(R.id.nametext);
            qtyText = itemView.findViewById(R.id.qtyText);
        }
    }

}
)
(dbfs:/FileStore/LiveMart/Customer/model_category.java,package com.example.oop_project.Main.Customer;

public class model_category {
    String image, pname;


    public model_category() {
    }

    public model_category(String image, String pname) {
        this.image = image;
        this.pname = pname;
    }

    public String getImage() {
        return image;
    }

    public void setImage(String image) {
        this.image = image;
    }

    public String getPname() {
        return pname;
    }

    public void setPname(String pname) {
        this.pname = pname;
    }

}
)
(dbfs:/FileStore/LiveMart/Customer/model_shop.java,package com.example.oop_project.Main.Customer;

public class model_shop {
    String latitude,longitude,price,quantity,rname;
    public model_shop() {
    }

    public model_shop(String latitude,String longitude, String price,String quantity,String rname) {
        this.rname = rname;
        this.price = price;
        this.quantity = quantity;
        this.latitude=latitude;
        this.longitude=longitude;
    }

    public String getLatitude() {
        return latitude;
    }

    public void setLatitude(String latitude) {
        this.latitude = latitude;
    }

    public String getLongitude() {
        return longitude;
    }

    public void setLongitude(String longitude) {
        this.longitude = longitude;
    }

    public String getPrice() {
        return price;
    }

    public void setPrice(String price) {
        this.price = price;
    }

    public String getQuantity() {
        return quantity;
    }

    public void setQuantity(String quantity) {
        this.quantity = quantity;
    }

    public String getRname() {
        return rname;
    }

    public void setRname(String rname) {
        this.rname = rname;
    }
})
(dbfs:/FileStore/LiveMart/Customer/model_subcategory.java,package com.example.oop_project.Main.Customer;

public class model_subcategory
{
    String image, pname,status;

    public model_subcategory() {
    }

    public model_subcategory(String image, String pname, String status) {
        this.image = image;
        this.pname = pname;
        this.status = status;
    }

    public String getImage() {
        return image;
    }

    public void setImage(String image) {
        this.image = image;
    }

    public String getPname() {
        return pname;
    }

    public void setPname(String pname) {
        this.pname = pname;
    }

    public String getStatus() {
        return status;
    }

    public void setStatus(String status) {
        this.status = status;
    }
}
)
(dbfs:/FileStore/LiveMart/Customer/myadapterCustomerCategory.java,package com.example.oop_project.Main.Customer;

import android.content.Intent;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.EditText;
import android.widget.ImageView;
import android.widget.TextView;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;
import androidx.recyclerview.widget.RecyclerView;

import com.bumptech.glide.Glide;
import com.example.oop_project.R;
import com.firebase.ui.database.FirebaseRecyclerAdapter;
import com.firebase.ui.database.FirebaseRecyclerOptions;
import com.google.firebase.database.DatabaseError;

public class myadapterCustomerCategory extends FirebaseRecyclerAdapter<model_category, myadapterCustomerCategory.myviewholder> {

    public myadapterCustomerCategory(@NonNull FirebaseRecyclerOptions<model_category> options) {
        super(options);
    }

    @Override
    public void onDataChanged() {
        super.onDataChanged();
    }

    @Override
    public void onError(@NonNull DatabaseError error) {

        super.onError(error);
        error.toException().printStackTrace();
    }


    @Override
    protected void onBindViewHolder(@NonNull myviewholder holder, int position, @NonNull final model_category model) {


        holder.nametext.setText(model.getPname());
        Glide.with(holder.img1.getContext()).load(model.getImage()).into(holder.img1);
        holder.cutdisttext.setVisibility(View.INVISIBLE);
        holder.cutDist.setVisibility(View.INVISIBLE);
        holder.Quant.setVisibility(View.INVISIBLE);
        holder.Quanttext.setVisibility(View.INVISIBLE);


//        if(model.getPname().equals("Fruits")) {
//            holder.itemView.setVisibility(View.VISIBLE);
//            }
//            else{
//            holder.itemView.setVisibility(View.GONE);
//        }


        holder.itemView.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
//                CustomerSubCategories(model.getPname())
                AppCompatActivity activity=(AppCompatActivity)view.getContext();
                activity.getSupportFragmentManager().beginTransaction().replace(R.id.container,new CustomerSubCategories(model.getPname())).addToBackStack(null).commit();


            }
        });
    }

    @NonNull
    @Override
    public myviewholder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
        View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.singlerowdesign, parent, false);
        return new myviewholder(view);
    }

    public class myviewholder extends RecyclerView.ViewHolder {
        ImageView img1;
        TextView nametext;
        TextView cutdisttext,Quant;
        EditText cutDist,Quanttext;

        public myviewholder(@NonNull View itemView) {
            super(itemView);

            Quanttext = itemView.findViewById(R.id.qtyText);
            Quant = itemView.findViewById(R.id.textView5);
            cutdisttext = itemView.findViewById(R.id.cutDisttext);
            cutDist = itemView.findViewById(R.id.cutDist);
            img1 = itemView.findViewById(R.id.img1);
            nametext = itemView.findViewById(R.id.nametext);

        }
    }

}
)
(dbfs:/FileStore/LiveMart/Customer/sharedpref.java,package com.example.oop_project.Main.Customer;

public interface sharedpref {
}
)
(dbfs:/FileStore/LiveMart/DatabaseClass.java,package com.example.oop_project.Main;

import android.content.Context;

import androidx.room.Database;
import androidx.room.Room;
import androidx.room.RoomDatabase;

@Database(entities = {EntityClass.class}, version = 1)
public abstract class DatabaseClass extends RoomDatabase {
    private static DatabaseClass INSTANCE;

    public abstract EventDao EventDao();

    public static DatabaseClass getDatabase(final Context context) {
        if (INSTANCE == null) {
            synchronized (DatabaseClass.class) {
                if (INSTANCE == null) {
                    INSTANCE =
                            Room.databaseBuilder(context.getApplicationContext(),
                                    DatabaseClass.class,
                                    "product_database").allowMainThreadQueries().build();
                }
            }
        }
        return INSTANCE;
    }
})
(dbfs:/FileStore/LiveMart/EntityClass.java,package com.example.oop_project.Main;

import androidx.room.ColumnInfo;
import androidx.room.Entity;
import androidx.room.PrimaryKey;

@Entity(tableName = "myTable")
public class EntityClass {
    @PrimaryKey(autoGenerate = true)
    int id;
    @ColumnInfo(name = "eventname")
    String eventname;
    @ColumnInfo(name = "eventdate")
    String eventdate;
    @ColumnInfo(name = "eventtime")

    String eventtime;


    public String getEventname() {
        return eventname;
    }

    public void setEventname(String eventname) {
        this.eventname = eventname;
    }

    public String getEventdate() {
        return eventdate;
    }

    public void setEventdate(String eventdate) {
        this.eventdate = eventdate;
    }

    public String getEventtime() {
        return eventtime;
    }

    public void setEventtime(String eventtime) {
        this.eventtime = eventtime;
    }
})
(dbfs:/FileStore/LiveMart/EventAdapter.java,package com.example.oop_project.Main;

import android.content.Context;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.LinearLayout;
import android.widget.TextView;

import androidx.annotation.NonNull;
import androidx.recyclerview.widget.RecyclerView;

import com.example.oop_project.R;

import java.util.List;

public class EventAdapter extends RecyclerView.Adapter<EventAdapter.ViewHolder> {
    Context context;
    List<EntityClass> entityClasses;

    public EventAdapter(Context context, List<EntityClass> entityClasses) {
        this.context = context;
        this.entityClasses = entityClasses;
    }

    @NonNull
    @Override
    public ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
        return new ViewHolder(LayoutInflater.from(parent.getContext()).inflate(R.layout.listings_row, parent, false));
    }

    @Override
    public void onBindViewHolder(@NonNull ViewHolder holder, int position) {
        holder.eventText.setText(entityClasses.get(position).getEventname());
        holder.timeAndDateText.setText(entityClasses.get(position).getEventdate() + " " + entityClasses.get(position).getEventtime());
    }

    @Override
    public int getItemCount() {
        return entityClasses.size();
    }

    class ViewHolder extends RecyclerView.ViewHolder {
        private TextView eventText, timeAndDateText;
        private LinearLayout toplayout;

        public ViewHolder(@NonNull View itemView) {
            super(itemView);
            eventText = (TextView) itemView.findViewById(R.id.event);
            timeAndDateText = (TextView) itemView.findViewById(R.id.time_and_date);
            toplayout = (LinearLayout) itemView.findViewById(R.id.toplayout);
        }
    }
})
(dbfs:/FileStore/LiveMart/EventDao.java,package com.example.oop_project.Main;
import androidx.room.Dao;
import androidx.room.Insert;
import androidx.room.Query;

import java.util.List;

@Dao
public interface EventDao {

    @Insert
    void insertAll(EntityClass entityClass);

    @Query("SELECT * FROM myTable")
    List<EntityClass> getAllData();

})
(dbfs:/FileStore/LiveMart/FeedbackDisplay.java,package com.example.oop_project.Main;

import android.os.Bundle;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Button;
import android.widget.EditText;
import android.widget.TextView;

import androidx.fragment.app.Fragment;
import androidx.recyclerview.widget.RecyclerView;

import com.example.oop_project.Main.Customer.myadapterCustomerCategory;
import com.example.oop_project.R;
import com.google.firebase.database.DatabaseReference;
import com.google.firebase.database.FirebaseDatabase;

import java.util.HashMap;
import java.util.Map;
import java.util.Random;

public class FeedbackDisplay extends Fragment {

    RecyclerView recview;
    myadapterCustomerCategory adapter;
    TextView tv,tv2;
    EditText et;
    Button bt;
    String fb;

    public FeedbackDisplay(String fb) {
        this.fb=fb;
    }


    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
    }

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {

        View view = inflater.inflate(R.layout.feedback_display, container, false);

        tv = view.findViewById(R.id.userguy);
        tv.setText(fb);
        return view;
    }

}
)
(dbfs:/FileStore/LiveMart/FeedbackFrag.java,package com.example.oop_project.Main;

import android.os.Bundle;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Button;
import android.widget.EditText;
import android.widget.TextView;

import androidx.fragment.app.Fragment;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;

import com.example.oop_project.Main.Customer.model_category;
import com.example.oop_project.Main.Customer.myadapterCustomerCategory;
import com.example.oop_project.R;
import com.firebase.ui.database.FirebaseRecyclerOptions;
import com.google.firebase.database.DatabaseReference;
import com.google.firebase.database.FirebaseDatabase;

import java.util.HashMap;
import java.util.Map;
import java.util.Random;

public class FeedbackFrag extends Fragment {

    RecyclerView recview;
    myadapterCustomerCategory adapter;
    TextView tv,tv2;
    EditText et;
    Button bt;
    String source;
    String p_usertype, p_username, arg_pname,retname;

    public FeedbackFrag(String p_usertype,String p_username,String arg_pname,String retname) {
        this.p_username=p_username;
        this.p_usertype=p_usertype;
        this.arg_pname=arg_pname;
        this.retname=retname;
    }


    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
    }

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {

        View view = inflater.inflate(R.layout.feedback_layout, container, false);

        tv = view.findViewById(R.id.feedbacktv);
        et = view.findViewById(R.id.feedbackip);
        bt = view.findViewById(R.id.addfbbtn);

        Random random = new Random();
        DatabaseReference db = FirebaseDatabase.getInstance().getReference();
        bt.setOnClickListener(new View.OnClickListener(){
            @Override
            //On click function
            public void onClick(View view) {
                tv.setText("Feedback Added!");
                Map<String, Object> map = new HashMap<>();
                map.put("feedback",et.getText().toString());
                map.put("seller",retname);
                Log.i("eeiu",p_username);
                Log.i("eeiu",p_usertype);
                Log.i("eeiu",arg_pname);
                if(p_usertype.equals("Customer")){
                    source = "Retailer";
                }else if(p_usertype.equals("Retailer")){
                    source = "Wholesaler";
                }
                if(db.child("Feedback").child(source).child(p_username).child(arg_pname).child(retname)!=null){
                    db.child("Feedback").child(source).child(retname).child(arg_pname).child(p_username).updateChildren(map);
                }else {
                    //db.child("Feedback").child(p_usertype).child(p_username).child(arg_pname).child(retname).setValue(map);
                    db.child("Feedback").child(source).child(retname).child(arg_pname).child(p_username).setValue(map);
                }
            }
        });
        return view;
    }

}
)
(dbfs:/FileStore/LiveMart/FragmentContent.java,package com.example.oop_project.Main;

import android.os.Bundle;

import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.fragment.app.Fragment;

import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.TextView;

import com.example.oop_project.R;

/**
 * A simple {@link Fragment} subclass.
 * Use the {@link FragmentContent#newInstance} factory method to
 * create an instance of this fragment.
 */
public class FragmentContent extends Fragment {
    private static final String KEY_TITLE = "Content";
    public FragmentContent() {
        // Required empty public constructor
    }

    public static FragmentContent newInstance(String param1) {
        FragmentContent fragment = new FragmentContent();
        Bundle args = new Bundle();
        args.putString(KEY_TITLE, param1);
        fragment.setArguments(args);
        return fragment;
    }

    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);

    }

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        // Inflate the layout for this fragment
        return inflater.inflate(R.layout.fragment_content, container, false);
    }

    @Override
    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {
        super.onViewCreated(view, savedInstanceState);

        String title = getArguments().getString(KEY_TITLE);
        ((TextView)view.findViewById(R.id.title123)).setText(title);
    }
})
(dbfs:/FileStore/LiveMart/Helper/FragmentNavigationManager.java,package com.example.oop_project.Main.Helper;

import android.content.Context;
import android.content.Intent;
import android.util.Log;

import androidx.fragment.app.Fragment;
import androidx.fragment.app.FragmentManager;
import androidx.fragment.app.FragmentTransaction;

import com.example.oop_project.Main.Admin.Admin;
import com.example.oop_project.Main.Customer.CustomerCart;
import com.example.oop_project.Main.Customer.CustomerCategories;
import com.example.oop_project.Main.Customer.CustomerOrders;
import com.example.oop_project.Main.FragmentContent;
import com.example.oop_project.Main.Interface.NavigationManager;
import com.example.oop_project.Main.NavigationBar;
import com.example.oop_project.Main.Wholesaler_Add;
import com.example.oop_project.Main.addprodnoimage;
import com.example.oop_project.R;
import com.example.oop_project.Main.Retailer.RetailerCategories;
import com.example.oop_project.Main.Retailer.RetailerOrders;
import com.example.oop_project.Main.Retailer.RetailerTrans;
import com.google.firebase.database.DataSnapshot;
import com.google.firebase.database.DatabaseError;
import com.google.firebase.database.FirebaseDatabase;
import com.google.firebase.database.ValueEventListener;
import com.rey.material.BuildConfig;

import java.util.ArrayList;

public class FragmentNavigationManager  extends Fragment implements NavigationManager {
    private FragmentManager mFragmentManager;
    private NavigationBar mainActivity;
    private static FragmentNavigationManager mInstance;
    private static String p_username;





    public FragmentNavigationManager() {

    }




    public static FragmentNavigationManager getminstance(NavigationBar mainActivity , String username){



        if(mInstance==null)
            mInstance= new FragmentNavigationManager();
        mInstance.configure(mainActivity);
        p_username=username;
        Log.i("checking","this is "+ p_username);
        return mInstance;
    }
    private void configure(NavigationBar mainActivity){
        mainActivity=mainActivity;
        mFragmentManager = mainActivity.getSupportFragmentManager();
    }
    @Override
    public void loadFragment(String title) {
        showFragment(FragmentContent.newInstance(title),false);
    }
    @Override
    public void showFragment(String parentItem, String childItem) {

//
//       Context context =  VerifyOTPActivity.getActivity()
//


        switch(parentItem)
        {
            case "Customer":
                switch(childItem)
                {
                    case "Categories":
                        showFragment(new CustomerCategories(),false);
                        Log.i("status","customer cat");
                        break;
                   
                    case "orders":
                        FirebaseDatabase.getInstance().getReference().child("Cart").child("Customer").child(p_username)
                                .addListenerForSingleValueEvent(new ValueEventListener() {

                                    @Override
                                    public void onDataChange(DataSnapshot dataSnapshot) {
                                        ArrayList<String> Keys = new ArrayList<>();
//                        Keys.clear();
                                        for (DataSnapshot snapshot : dataSnapshot.getChildren()) {
                                            Keys.add(snapshot.getKey());
                                            Log.i("randomstuff",snapshot.getKey());
                                        }
                                        FragmentManager fm =  mFragmentManager;
                                        FragmentTransaction ft = fm.beginTransaction().replace(R.id.container,new CustomerOrders(Keys,p_username));
                                        ft.addToBackStack(null);
                                        if(false || !BuildConfig.DEBUG){
                                            ft.commitAllowingStateLoss();
                                        }else{
                                            ft.commit();
                                        }
                                        fm.executePendingTransactions();
                                    }
                                    @Override
                                    public void onCancelled(DatabaseError databaseError) {
                                    }
                                });
                        break;
                }
                break;
            case "Retailer":
                switch(childItem)
                {
                    case "Categories":
                        showFragment(new RetailerCategories(),false);
                        Log.i("status","retailer cat");
                        break;
                    case "Cart":
                        FirebaseDatabase.getInstance().getReference().child("Cart").child("Retailer").child(p_username)
                                .addListenerForSingleValueEvent(new ValueEventListener() {

                                    @Override
                                    public void onDataChange(DataSnapshot dataSnapshot) {
                                        ArrayList<String> Keys = new ArrayList<>();
//                        Keys.clear();
                                        for (DataSnapshot snapshot : dataSnapshot.getChildren()) {
                                            Keys.add(snapshot.getKey());
                                            Log.i("randomstuff",snapshot.getKey());
                                        }
                                        FragmentManager fm =  mFragmentManager;
                                        FragmentTransaction ft = fm.beginTransaction().replace(R.id.container,new RetailerOrders(Keys));
                                        ft.addToBackStack(null);
                                        if(false || !BuildConfig.DEBUG){
                                            ft.commitAllowingStateLoss();
                                        }else{
                                            ft.commit();
                                        }
                                        fm.executePendingTransactions();
                                    }
                                    @Override
                                    public void onCancelled(DatabaseError databaseError) {
                                    }
                                });

                        break;
                    case "transactions":
                        FirebaseDatabase.getInstance().getReference().child("Transaction").child("Retailer").child(p_username)
                                .addListenerForSingleValueEvent(new ValueEventListener() {

                                    @Override
                                    public void onDataChange(DataSnapshot dataSnapshot) {
                                        ArrayList<String> Keys = new ArrayList<>();
//                        Keys.clear();
                                        for (DataSnapshot snapshot : dataSnapshot.getChildren()) {
                                            Keys.add(snapshot.getKey());
                                            Log.i("randomstuff",snapshot.getKey());
                                        }
                                        FragmentManager fm =  mFragmentManager;
                                        FragmentTransaction ft = fm.beginTransaction().replace(R.id.container,new RetailerTrans(Keys,false));
                                        ft.addToBackStack(null);
                                        if(false || !BuildConfig.DEBUG){
                                            ft.commitAllowingStateLoss();
                                        }else{
                                            ft.commit();
                                        }
                                        fm.executePendingTransactions();
                                    }
                                    @Override
                                    public void onCancelled(DatabaseError databaseError) {
                                    }
                                });

                        break;
                }
                break;
            case "Wholesaler":
                switch(childItem)
                {
                    case "add item":
                        showFragment(new Wholesaler_Add(),false);
                        break;
                    case "transactions":
                        FirebaseDatabase.getInstance().getReference().child("Transaction").child("Wholesaler").child(p_username)
                                .addListenerForSingleValueEvent(new ValueEventListener() {

                                    @Override
                                    public void onDataChange(DataSnapshot dataSnapshot) {
                                        ArrayList<String> Keys = new ArrayList<>();
//                        Keys.clear();
                                        for (DataSnapshot snapshot : dataSnapshot.getChildren()) {
                                            Keys.add(snapshot.getKey());
                                            Log.i("randomstuff",snapshot.getKey());
                                        }
                                        FragmentManager fm =  mFragmentManager;
                                        FragmentTransaction ft = fm.beginTransaction().replace(R.id.container,new RetailerTrans(Keys,true));
                                        ft.addToBackStack(null);
                                        if(false || !BuildConfig.DEBUG){
                                            ft.commitAllowingStateLoss();
                                        }else{
                                            ft.commit();
                                        }
                                        fm.executePendingTransactions();
                                    }
                                    @Override
                                    public void onCancelled(DatabaseError databaseError) {
                                    }
                                });

                        break;
                    case "about":
                        showFragment(new Admin(),false);
                        break;
                }
                break;
            default:
                System.out.println("no match");
        }


    }
    public void showFragment(Fragment fragmentContent, boolean b){

        FragmentManager fm =  mFragmentManager;
        FragmentTransaction ft = fm.beginTransaction().replace(R.id.container,fragmentContent);
        ft.addToBackStack(null);
        if(b || !BuildConfig.DEBUG){
            ft.commitAllowingStateLoss();
        }else{
            ft.commit();
        }
        fm.executePendingTransactions();
    }

})
(dbfs:/FileStore/LiveMart/Interface/NavigationManager.java,package com.example.oop_project.Main.Interface;

public interface NavigationManager  {
    void showFragment(String parentItem, String childItem);
    public void loadFragment(String title);
}
)
(dbfs:/FileStore/LiveMart/LaunchActivity.java,package com.example.oop_project.Main;

import androidx.appcompat.app.AppCompatActivity;

import android.content.DialogInterface;
import android.content.Intent;
import android.os.Bundle;
import android.view.View;
import android.widget.RelativeLayout;

import com.example.oop_project.R;

public class LaunchActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_launch);

        RelativeLayout rlayout = (RelativeLayout) findViewById(R.id.mainlayout);
        rlayout.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                Intent intent = new Intent(LaunchActivity.this, MainActivity.class);
                startActivity(intent);
            }
        });

    }
})
(dbfs:/FileStore/LiveMart/LoginActivity.java,package com.example.oop_project.Main;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;

import android.content.Intent;
import android.content.SharedPreferences;
import android.os.Bundle;
import android.view.View;
import android.widget.ArrayAdapter;
import android.widget.Button;
import android.widget.Spinner;
import android.widget.TextView;
import android.widget.Toast;

import com.example.oop_project.R;
import com.google.firebase.database.DataSnapshot;
import com.google.firebase.database.DatabaseError;
import com.google.firebase.database.DatabaseReference;
import com.google.firebase.database.FirebaseDatabase;
import com.google.firebase.database.ValueEventListener;

public class LoginActivity extends AppCompatActivity {

    private TextView t_username, t_password;
    private Button login;
    String username, password, user_type;
    Spinner s_usertype;




    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_login);

        t_password = findViewById(R.id.login_password_input);
        t_username = findViewById(R.id.login_username);
        login = findViewById(R.id.login_btn);
        s_usertype = findViewById(R.id.spinner_user);

        {
             s_usertype = (Spinner) findViewById(R.id.spinner_user);
            ArrayAdapter<String> myAdapter = new ArrayAdapter<String>(this,
                    android.R.layout.simple_list_item_1, getResources().getStringArray(R.array.users));
            myAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
            s_usertype.setAdapter(myAdapter);
        } //Spinner Initialization


        login.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {


                username = t_username.getText().toString().trim();
                password = t_password.getText().toString().trim();
                user_type = s_usertype.getSelectedItem().toString().trim();


                if (username.isEmpty()) {
                    t_username.setError("Please enter the username!");
                }

                if (password.isEmpty()) {
                    t_password.setError("Please enter the password!");
                }


                DatabaseReference rootref;
                rootref = FirebaseDatabase.getInstance().getReference();

                final DatabaseReference orders_Reference = rootref.child("User").child(user_type).child(username).child("Details");

                rootref.addListenerForSingleValueEvent(new ValueEventListener() {
                    @Override
                    public void onDataChange(@NonNull DataSnapshot snapshot) {
                        if ((snapshot.child("User").child(user_type).child(username).exists())){

                            orders_Reference.addListenerForSingleValueEvent(new ValueEventListener() {
                                @Override
                                public void onDataChange(@NonNull DataSnapshot snapshot) {
                                    for (DataSnapshot data : snapshot.getChildren()) {
                                        if(data.getKey().equals("password")){
                                            String temp = data.getValue().toString();
                                            if (temp.equals(password)){


                                                {
                                                    SharedPreferences sharedPreferences = getSharedPreferences("MySharedPref", MODE_PRIVATE);

// Creating an Editor object to edit(write to the file)
                                                    SharedPreferences.Editor myEdit = sharedPreferences.edit();

// Storing the key and its value as the data fetched from edittext
                                                    myEdit.putString("username", username);
                                                    myEdit.putString("usertype", user_type);

                                                    myEdit.commit();
                                                }
                                                Intent intent = new Intent(LoginActivity.this,SendOTPActivity.class);
                                                startActivity(intent);
                                            } else {
                                                Toast.makeText(LoginActivity.this, "Wrong Password", Toast.LENGTH_SHORT).show();
                                            }
                                        }
                                    }
                                }

                                @Override
                                public void onCancelled(@NonNull DatabaseError error) {

                                }
                            });

                        } else {
                            Toast.makeText(LoginActivity.this, "Invalid Username", Toast.LENGTH_SHORT).show();
                        }
                    }

                    @Override
                    public void onCancelled(@NonNull DatabaseError error) {

                    }
                });


            }

        });

    }

})
(dbfs:/FileStore/LiveMart/MainActivity.java,package com.example.oop_project.Main;

import androidx.appcompat.app.AppCompatActivity;

import android.content.Intent;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;

import com.example.oop_project.R;
import com.google.firebase.database.DatabaseReference;
import com.google.firebase.database.FirebaseDatabase;

public class MainActivity extends AppCompatActivity {

    private Button joinNowButton, loginButton, navbartestButton;


    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);


        joinNowButton = (Button) findViewById(R.id.main_join_now_btn);
        loginButton = (Button) findViewById(R.id.main_login_btn);
        navbartestButton = (Button) findViewById(R.id.navbartest);

        joinNowButton.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                Intent intent = new Intent(MainActivity.this, RegisterActivity.class);
                startActivity(intent);
            }
        });



        loginButton.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                Intent intent = new Intent(MainActivity.this, LoginActivity.class);
                startActivity(intent);
            }
        });
        navbartestButton.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                Intent intent = new Intent(MainActivity.this, NavigationBar.class);
                startActivity(intent);




            }
        });

    }
}

)
(dbfs:/FileStore/LiveMart/MyItems/Adapter_MyItems.java,package com.example.oop_project.Main.MyItems;

import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ImageView;
import android.widget.TextView;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;
import androidx.recyclerview.widget.RecyclerView;

import com.bumptech.glide.Glide;
import com.example.oop_project.R;
import com.firebase.ui.database.FirebaseRecyclerAdapter;
import com.firebase.ui.database.FirebaseRecyclerOptions;

public class Adapter_MyItems extends FirebaseRecyclerAdapter<model_items_cat, Adapter_MyItems.itemviewholder> {


    public Adapter_MyItems(@NonNull FirebaseRecyclerOptions<model_items_cat> options) {
        super(options);
    }

    @Override
    protected void onBindViewHolder(@NonNull itemviewholder holder, int position, @NonNull model_items_cat model) {
        holder.nametext.setText(model.getPname());
        Glide.with(holder.img1.getContext()).load(model.getImage()).into(holder.img1);

        holder.itemView.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                AppCompatActivity activity=(AppCompatActivity)v.getContext();
                activity.getSupportFragmentManager().beginTransaction().replace(R.id.container,new item_sub(model.pname)).addToBackStack(null).commit();
            }
        });

    }

    @NonNull
    @Override
    public itemviewholder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
        View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.itemdesign, parent, false);
        return new itemviewholder(view);
    }

    public class itemviewholder extends RecyclerView.ViewHolder
    {
        ImageView img1;
        TextView nametext;

        public itemviewholder(@NonNull View itemView) {
            super(itemView);

            img1 = itemView.findViewById(R.id.img1);
            nametext = itemView.findViewById(R.id.nametext);
        }
    }
}
)
(dbfs:/FileStore/LiveMart/MyItems/MyItems.java,package com.example.oop_project.Main.MyItems;

import android.os.Bundle;

import androidx.fragment.app.Fragment;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;

import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;

import com.example.oop_project.R;
import com.firebase.ui.database.FirebaseRecyclerOptions;
import com.google.firebase.database.FirebaseDatabase;

public class MyItems extends Fragment {



    RecyclerView recview;
    Adapter_MyItems adapter;


    public MyItems() {
        // Required empty public constructor
    }




    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        // Inflate the layout for this fragment

        View view = inflater.inflate(R.layout.fragment_my_items, container, false);

        recview = (RecyclerView) view.findViewById(R.id.recview_items);
        recview.setLayoutManager(new LinearLayoutManager(getContext()));


        FirebaseRecyclerOptions<model_items_cat> options =
                new FirebaseRecyclerOptions.Builder<model_items_cat>()
                        .setQuery(FirebaseDatabase.getInstance().getReference().child("Products").child("Categories"), model_items_cat.class)
                        .build();

        adapter = new Adapter_MyItems(options);
        recview.setAdapter(adapter);


        return view;



    }

    @Override
    public void onStart() {
        super.onStart();
        adapter.startListening();
    }

    @Override
    public void onStop() {
        super.onStop();
        adapter.stopListening();
    }
})
(dbfs:/FileStore/LiveMart/MyItems/adapter_itemsub.java,package com.example.oop_project.Main.MyItems;

import android.content.Context;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.TextView;

import androidx.annotation.NonNull;
import androidx.recyclerview.widget.RecyclerView;

import com.example.oop_project.R;
import com.firebase.ui.database.FirebaseRecyclerAdapter;
import com.firebase.ui.database.FirebaseRecyclerOptions;

public class adapter_itemsub extends FirebaseRecyclerAdapter<model_itemsub,adapter_itemsub.myitemsubviewholder>{


    public adapter_itemsub(@NonNull FirebaseRecyclerOptions<model_itemsub> options, Context context) {

        super(options);
    }

    @Override
    protected void onBindViewHolder(@NonNull myitemsubviewholder holder, int position, @NonNull model_itemsub model) {
        holder.product_name.setText(model.getPname());
        holder.price.setText(model.getPrice());
        holder.quantity.setText(model.getQuantity());


    }

    @NonNull
    @Override
    public myitemsubviewholder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
        View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.myitems_card, parent, false);
        return new myitemsubviewholder(view);    }

    public class myitemsubviewholder extends RecyclerView.ViewHolder{
            TextView product_name,price,quantity;
            public myitemsubviewholder(@NonNull View itemView) {
                super(itemView);

                product_name = itemView.findViewById(R.id.textView4);
                price = itemView.findViewById(R.id.pricelabel);
                quantity = itemView.findViewById(R.id.quanitylabel);
            }
        }





}



//
//
//
)
(dbfs:/FileStore/LiveMart/MyItems/item_sub.java,package com.example.oop_project.Main.MyItems;

import android.content.Context;
import android.content.SharedPreferences;
import android.os.Bundle;

import androidx.fragment.app.Fragment;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;

import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;

import com.example.oop_project.R;
import com.firebase.ui.database.FirebaseRecyclerOptions;
import com.google.firebase.database.FirebaseDatabase;


public class item_sub extends Fragment {
    RecyclerView recview;
    adapter_itemsub adapter;
    String prod_type;



    public item_sub(){

    }

    public item_sub(String prod_type){
    this.prod_type=prod_type;
    }

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {

        SharedPreferences sh = getActivity().getSharedPreferences("MySharedPref", Context.MODE_PRIVATE);

        // The value will be default as empty string because for
// the very first time when the app is opened, there is nothing to show
        String p_username = sh.getString("username", "Retailer");
        String p_usertype = sh.getString("usertype", "Fgretailer");

        View view = inflater.inflate(R.layout.fragment_item_sub, container, false);

        recview = (RecyclerView) view.findViewById(R.id.recview_itemssub);
        recview.setLayoutManager(new LinearLayoutManager(getContext()));


        FirebaseRecyclerOptions<model_itemsub> options =
                new FirebaseRecyclerOptions.Builder<model_itemsub>()
                        .setQuery(FirebaseDatabase.getInstance().getReference().child("User").child(p_usertype).child(p_username).child("Products").child(prod_type), model_itemsub.class)
                        .build();


            adapter = new adapter_itemsub(options,getContext());
            recview.setAdapter(adapter);

        return  view;
    }

    @Override
    public void onStart() {
        super.onStart();
        adapter.startListening();
    }

    @Override
    public void onStop() {
        super.onStop();
        adapter.stopListening();
    }
})
(dbfs:/FileStore/LiveMart/MyItems/model_items_cat.java,package com.example.oop_project.Main.MyItems;

public class model_items_cat {
    String image, pname;


    public model_items_cat() {
    }

    public model_items_cat(String image, String pname) {
        this.image = image;
        this.pname = pname;
    }

    public String getImage() {
        return image;
    }

    public void setImage(String image) {
        this.image = image;
    }

    public String getPname() {
        return pname;
    }

    public void setPname(String pname) {
        this.pname = pname;
    }

}
)
(dbfs:/FileStore/LiveMart/MyItems/model_itemsub.java,package com.example.oop_project.Main.MyItems;

public class model_itemsub {
    String pname , price , quantity;

    public model_itemsub(String pname, String price, String quantity) {
        this.pname = pname;
        this.price = price;
        this.quantity = quantity;
    }

    public model_itemsub() {
    }

    public String getPname() {
        return pname;
    }

    public void setPname(String pname) {
        this.pname = pname;
    }

    public String getPrice() {
        return price;
    }

    public void setPrice(String price) {
        this.price = price;
    }

    public String getQuantity() {
        return quantity;
    }

    public void setQuantity(String quantity) {
        this.quantity = quantity;
    }
}
)
(dbfs:/FileStore/LiveMart/NavigationBar.java,package com.example.oop_project.Main;

import android.content.Context;
import android.content.SharedPreferences;
import android.content.res.Configuration;
import android.os.Bundle;
import android.util.Log;
import android.view.Menu;
import android.view.MenuItem;
import android.view.View;
import android.widget.ExpandableListAdapter;
import android.widget.ExpandableListView;

import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.appcompat.app.ActionBarDrawerToggle;
import androidx.appcompat.app.AppCompatActivity;
import androidx.core.view.GravityCompat;
import androidx.drawerlayout.widget.DrawerLayout;

import com.example.oop_project.Main.Adapter.CustomExpandableListAdapter;
import com.example.oop_project.Main.Helper.FragmentNavigationManager;
import com.example.oop_project.Main.Interface.NavigationManager;
import com.example.oop_project.R;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.Map;
import java.util.TreeMap;

public class NavigationBar extends AppCompatActivity {

    /*private String[] groupItem = {"Customer","Retailer","Wholesaler"};
    private String[][] childItem = {{"Categories","Cart","orders","logout"},{"Categories","Cart","orders","add item","logout"},
            {"orders","add item","logout"}};*/
    private DrawerLayout mDrawerLayout;
    private ActionBarDrawerToggle mDrawerToggle;
    private String mActivityTitle;
    private String[] items;
    public static String usertyp;
    private ExpandableListView expandableListView;
    private ExpandableListAdapter adapter;
    private List<String> lstTitle;
    private Map<String,List<String>> lstChild;
    private NavigationManager navigationManager;
    public static int n=0;

    @Override
    protected void onCreate(@Nullable Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.actvity_navbar);

        SharedPreferences sh = getApplicationContext().getSharedPreferences("MySharedPref", Context.MODE_PRIVATE);

        String product_username  = sh.getString("username", "Fgretailer");
        String usert = sh.getString("usertype","Retailer");
        usertyp=usert;
        Log.i("memes", ""+product_username);
        //init view
        mDrawerLayout = (DrawerLayout) findViewById(R.id.drawer_layout);
        mActivityTitle = getTitle().toString();
        expandableListView = (ExpandableListView) findViewById(R.id.navList);
        navigationManager = FragmentNavigationManager.getminstance(this,product_username);
        initItems();

        View listHeaderView = getLayoutInflater().inflate(R.layout.nav_header,null,false);
        expandableListView.addHeaderView(listHeaderView);
        gendata();
        addDrawersItem();
        setupDrawer();
        if(savedInstanceState ==null){
            selectFirstItemAsDefault();
        }
        getSupportActionBar().setDisplayHomeAsUpEnabled(true);
        getSupportActionBar().setHomeButtonEnabled(true);
        getSupportActionBar().setTitle("OOPS Project");
    }
    private void selectFirstItemAsDefault(){
        if(navigationManager!=null){
            String firstItem = lstTitle.get(0);
            navigationManager.loadFragment(firstItem);
            getSupportActionBar().setTitle(firstItem);
        }
    }
    private void setupDrawer() {
        mDrawerToggle = new ActionBarDrawerToggle(this, mDrawerLayout,R.string.open,R.string.close)
        {
            @Override
            public void onDrawerOpened(View drawerView) {
                super.onDrawerOpened(drawerView);
                //getSupportActionBar().setTitle("OOPS Project");
                invalidateOptionsMenu();
            }

            @Override
            public void onDrawerClosed(View drawerView) {
                super.onDrawerClosed(drawerView);
                //getSupportActionBar().setTitle(mActivityTitle);
                invalidateOptionsMenu();
            }

        };
        mDrawerToggle.setDrawerIndicatorEnabled(true);
        mDrawerLayout.setDrawerListener(mDrawerToggle);
    }

    private void addDrawersItem() {
        Log.i("kardib2",String.valueOf(lstTitle.size()));
        Log.i("kardib2",String.valueOf(lstChild.size()));
        adapter =  new CustomExpandableListAdapter(this, lstTitle,lstChild);
        expandableListView.setAdapter(adapter);
        expandableListView.setOnGroupExpandListener(new ExpandableListView.OnGroupExpandListener() {
            @Override
            public void onGroupExpand(int groupPosition) {
                getSupportActionBar().setTitle(lstTitle.get(groupPosition).toString());
            }
        });
        expandableListView.setOnGroupCollapseListener(new ExpandableListView.OnGroupCollapseListener() {
            @Override
            public void onGroupCollapse(int groupPosition) {
                getSupportActionBar().setTitle("OOPS Project");
            }
        });

        expandableListView.setOnChildClickListener(new ExpandableListView.OnChildClickListener() {
            @Override
            public boolean onChildClick(ExpandableListView parent, View v, int groupPosition, int childPosition, long id) {
                String selectedItem = ((List) lstChild.get(lstTitle.get(groupPosition))).get(childPosition).toString();
                getSupportActionBar().setTitle(selectedItem);
                String parentItem = lstTitle.get(groupPosition);
                if(items[0].equals(parentItem)){
                    navigationManager.showFragment(parentItem.toString(), selectedItem);
                }else if(items[1].equals(parentItem)){
                    navigationManager.showFragment(parentItem.toString(), selectedItem);
                }else if(items[2].equals(parentItem)){
                    navigationManager.showFragment(parentItem.toString(), selectedItem);
                }else{
                    throw new IllegalArgumentException("Not supported Fragment");
                }
                mDrawerLayout.closeDrawer(GravityCompat.START);
                return false;
            }
        });
    }

    private void gendata(){
        List<String> title = Arrays.asList("Customer","Retailer","Wholesaler");
        List<String> childitem1 = Arrays.asList("Categories","Cart","orders");
        List<String> childitem2 = Arrays.asList("Categories","transactions","Cart");
        List<String> childitem3 = Arrays.asList("transactions","add item","about");
//        List<String> error1 = Arrays.asList("NOT ACCESSIBLE","ONLY CUSTOMERS","CAN VIEW");
//        List<String> error2 = Arrays.asList("NOT ACCESSIBLE","ONLY RETAILERS","CAN VIEW");
//        List<String> error3 = Arrays.asList("NOT ACCESSIBLE","ONLY WHOLESALERS","CAN VIEW");
        lstChild = new TreeMap<>();
//        if(usertyp.equals(title.get(0))){
//            lstChild.put(title.get(0),childitem1);
//            lstChild.put(title.get(2),error3);
//            lstChild.put(title.get(1),error2);
//            Log.i("kardib3",String.valueOf(n));
//
//        }else if(usertyp.equals(title.get(1))){
//            lstChild.put(title.get(1),childitem2);
//            lstChild.put(title.get(0),error1);
//            lstChild.put(title.get(2),error3);
//            Log.i("kardib3",String.valueOf(n));
//        }else if(usertyp.equals(title.get(2))){
//            lstChild.put(title.get(2),childitem3);
//            lstChild.put(title.get(1),error2);
//            lstChild.put(title.get(0),error1);
//        }
        lstChild.put(title.get(0),childitem1);
        lstChild.put(title.get(1),childitem2);
        lstChild.put(title.get(2),childitem3);
        lstTitle = new ArrayList<>(lstChild.keySet());

    }
    private void initItems(){
        items = new String[] {"Customer","Retailer","Wholesaler"};
    }

    @Override
    public boolean onCreateOptionsMenu(Menu menu) {
        getMenuInflater().inflate(R.menu.main_menu,menu);
        return true;
    }

    @Override
    public boolean onOptionsItemSelected(@NonNull MenuItem item) {
        int id = item.getItemId();

        if(mDrawerToggle.onOptionsItemSelected(item))
            return true;

        return super.onOptionsItemSelected(item);
    }

    @Override
    protected void onPostCreate(@Nullable Bundle savedInstanceState) {
        super.onPostCreate(savedInstanceState);
        mDrawerToggle.syncState();
    }

    @Override
    public void onConfigurationChanged(@NonNull Configuration newConfig) {
        super.onConfigurationChanged(newConfig);
        mDrawerToggle.onConfigurationChanged(newConfig);
    }
})
(dbfs:/FileStore/LiveMart/NotificationMessage.java,package com.example.oop_project.Main;

import android.os.Bundle;
import android.widget.TextView;

import androidx.appcompat.app.AppCompatActivity;

import com.example.oop_project.R;

public class NotificationMessage extends AppCompatActivity {
    TextView textView;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_notification_message);
        textView = findViewById(R.id.tv_message);
        Bundle bundle = getIntent().getExtras();
        textView.setText(bundle.getString("message"));

    }
})
(dbfs:/FileStore/LiveMart/RegisterActivity.java,package com.example.oop_project.Main;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;
import androidx.core.app.ActivityCompat;
import androidx.core.content.ContextCompat;

import android.Manifest;
import android.annotation.SuppressLint;
import android.content.Intent;
import android.content.pm.PackageManager;
import android.location.Address;
import android.location.Geocoder;
import android.location.Location;
import android.location.LocationListener;
import android.location.LocationManager;
import android.os.Bundle;
import android.util.Log;
import android.view.View;
import android.widget.ArrayAdapter;
import android.widget.Button;
import android.widget.EditText;
import android.widget.Spinner;
import android.widget.TextView;
import android.widget.Toast;

import com.example.oop_project.R;
import com.google.android.gms.tasks.OnCompleteListener;
import com.google.android.gms.tasks.Task;
import com.google.firebase.database.DataSnapshot;
import com.google.firebase.database.DatabaseError;
import com.google.firebase.database.DatabaseReference;
import com.google.firebase.database.FirebaseDatabase;
import com.google.firebase.database.ValueEventListener;

import java.util.HashMap;
import java.util.List;
import java.util.Locale;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

import static android.widget.Toast.LENGTH_LONG;

public class RegisterActivity extends AppCompatActivity implements LocationListener {


    private Button create, button_location;
    private EditText InputName, InputPhoneNumber, InputPassword, ConfirmPassword, EmailID;
    private Spinner UserType;
    LocationManager locationManager;
    Double user_latitude, user_longitude;
    String s_long,s_lat;
    private TextView Longitude_tfield, Latitude_tfield;


    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_register);

        {
            Spinner mySpinner = (Spinner) findViewById(R.id.type_customer);
            ArrayAdapter<String> myAdapter = new ArrayAdapter<String>(this,
                    android.R.layout.simple_list_item_1, getResources().getStringArray(R.array.users));
            myAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
            mySpinner.setAdapter(myAdapter);
        } //Spinner Initialization

        {
            create = (Button) findViewById(R.id.reg_btn);
            InputName = (EditText) findViewById(R.id.editText);
            InputPassword = (EditText) findViewById(R.id.password_reg);
            EmailID = (EditText) findViewById(R.id.email);
            ConfirmPassword = (EditText) findViewById(R.id.editText2);
            InputPhoneNumber = (EditText) findViewById(R.id.reg_phone_number);
            UserType = (Spinner) findViewById(R.id.type_customer);
            button_location = findViewById(R.id.button_location);
            Longitude_tfield = findViewById(R.id.longitude_text);
            Latitude_tfield = findViewById(R.id.latitude_text);

        } //View Object Creation

        if (ContextCompat.checkSelfPermission(RegisterActivity.this, Manifest.permission.ACCESS_FINE_LOCATION)
                != PackageManager.PERMISSION_GRANTED) {
            ActivityCompat.requestPermissions(RegisterActivity.this, new String[]{
                    Manifest.permission.ACCESS_FINE_LOCATION
            }, 100);
        }


        button_location.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {

                getLocation();


            }
        });

        create.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {

                String username = InputName.getText().toString().trim();
                String number = InputPhoneNumber.getText().toString().trim();
                String pwd = InputPassword.getText().toString().trim();
                String mail = EmailID.getText().toString().trim();
                String repwd = ConfirmPassword.getText().toString().trim();
                String user = UserType.getSelectedItem().toString().trim();
                       String longitude = Longitude_tfield.getText().toString().trim();
                       String latitude = Latitude_tfield.getText().toString().trim();


                ValidateName();
                ValidatePhone();
                ValidateEmail();
                ValidatePwd();
                ValidateUser();


                DatabaseReference rootref;
                rootref = FirebaseDatabase.getInstance().getReference();

                rootref.addListenerForSingleValueEvent(new ValueEventListener() {
                    @Override
                    public void onDataChange(@NonNull DataSnapshot snapshot) {

                        if (user.contains("Customer")) {

                            if (!(snapshot.child("User").child("Customer").child(username).exists())) {
                                HashMap<String, Object> userdataMap = new HashMap<>();
                                userdataMap.put("phone", number);
                                userdataMap.put("password", pwd);
                                userdataMap.put("username", username);
                                userdataMap.put("email", mail);
                                userdataMap.put("latitude", s_long);
                                userdataMap.put("longitude", s_lat);
                                userdataMap.put("UID", "UID_3");


                                rootref.child("User").child("Customer").child(username).child("Details").updateChildren(userdataMap)
                                        .addOnCompleteListener(new OnCompleteListener<Void>() {
                                            @Override
                                            public void onComplete(@NonNull Task<Void> task) {


                                                if (task.isSuccessful()) {
                                                    Toast.makeText(RegisterActivity.this, "Congratulations, your account has been created.", Toast.LENGTH_SHORT).show();
                                                    Intent intent = new Intent(RegisterActivity.this, MainActivity.class);
                                                    intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);
                                                    startActivity(intent);
                                                } else {
                                                    Toast.makeText(RegisterActivity.this, "Network Error: Please try again after some time...", Toast.LENGTH_SHORT).show();
                                                }

                                            }
                                        });
                            } else {
                                Toast.makeText(getApplicationContext(), "An account with this username already exists", LENGTH_LONG).show();
                                Intent intent = new Intent(RegisterActivity.this, MainActivity.class);
                                intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);
                                startActivity(intent);
                            }

                        } else if (user.contains("Retailer")) {
                            if (!(snapshot.child("User").child("Retailer").child(username).exists())) {
                                HashMap<String, Object> userdataMap = new HashMap<>();
                                userdataMap.put("phone", number);
                                userdataMap.put("password", pwd);
                                userdataMap.put("username", username);
                                userdataMap.put("email", mail);
                                userdataMap.put("latitude", s_lat);
                                userdataMap.put("longitude", s_long);
                                userdataMap.put("UID", "UID_3");



                                Log.i("Wazzup", "is it working");

                                rootref.child("User").child("Retailer").child(username).child("Details").updateChildren(userdataMap)
                                        .addOnCompleteListener(new OnCompleteListener<Void>() {
                                            @Override
                                            public void onComplete(@NonNull Task<Void> task) {


                                                if (task.isSuccessful()) {
                                                    Toast.makeText(RegisterActivity.this, "Congratulations, your account has been created.", Toast.LENGTH_SHORT).show();


                                                    Intent intent = new Intent(RegisterActivity.this, MainActivity.class);
                                                    intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);
                                                    startActivity(intent);
                                                } else {

                                                    Toast.makeText(RegisterActivity.this, "Network Error: Please try again after some time...", Toast.LENGTH_SHORT).show();
                                                }

                                            }
                                        });
                            } else {
                                Toast.makeText(getApplicationContext(), "An account with this username already exists", LENGTH_LONG).show();
                                Intent intent = new Intent(RegisterActivity.this, MainActivity.class);
                                intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);
                                startActivity(intent);
                            }
                        } else if (user.contains("Wholesaler")) {

                            if (!(snapshot.child("User").child("Wholesaler").child(username).exists())) {
                                HashMap<String, Object> userdataMap = new HashMap<>();
                                userdataMap.put("phone", number);
                                userdataMap.put("password", pwd);
                                userdataMap.put("username", username);
                                userdataMap.put("email", mail);
                                userdataMap.put("latitude", s_lat);
                                userdataMap.put("longitude", s_long);

                                rootref.child("User").child("Wholesaler").child(username).child("Details").updateChildren(userdataMap)
                                        .addOnCompleteListener(new OnCompleteListener<Void>() {
                                            @Override
                                            public void onComplete(@NonNull Task<Void> task) {


                                                if (task.isSuccessful()) {
                                                    Toast.makeText(RegisterActivity.this, "Congratulations, your account has been created.", Toast.LENGTH_SHORT).show();


                                                    Intent intent = new Intent(RegisterActivity.this, MainActivity.class);
                                                    intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);
                                                    startActivity(intent);
                                                } else {

                                                    Toast.makeText(RegisterActivity.this, "Network Error: Please try again after some time...", Toast.LENGTH_SHORT).show();
                                                }

                                            }
                                        });
                            } else {
                                Toast.makeText(getApplicationContext(), "An account with this username already exists", LENGTH_LONG).show();
                                Intent intent = new Intent(RegisterActivity.this, MainActivity.class);
                                startActivity(intent);
                            }
                        }

                    }

                    @Override
                    public void onCancelled(@NonNull DatabaseError error) {

                    }
                });


            }


            private void ValidateName() {

                String name = InputName.getText().toString();
                if (name.isEmpty()) {
                    InputName.setError("Please enter your Username !");
                    return;
                }


            }

            private void ValidatePhone() {

                String phone = InputPhoneNumber.getText().toString();
                String regez_num = "^\\d{10}$";

                Pattern pattern = Pattern.compile(regez_num);
                Matcher matcher = pattern.matcher(phone);

                if (phone.isEmpty()) {
                    InputPhoneNumber.setError("Please enter your contact number !");
                    return;
                } else if(!(matcher.matches())){
                    InputPhoneNumber.setError("Please enter a valid 10 digit contact number !");
                    return;
                }

            }

            private void ValidateEmail() {

                String mail = EmailID.getText().toString();

                String regex = "^(.+)@(.+)$";

                Pattern pattern = Pattern.compile(regex);
                Matcher matcher = pattern.matcher(mail);

                if (mail.isEmpty()) {
                    EmailID.setError("Please enter your email ID");
                    return;
                } else if (!(matcher.matches())) {
                    EmailID.setError("Please enter a valid email ID");
                    return;
                }
            }

            private void ValidatePwd() {
                String password = InputPassword.getText().toString();
                String repass = ConfirmPassword.getText().toString();

                if (password.isEmpty()) {
                    InputPassword.setError("Please enter your Password !");
                    return;
                } else if (!(password.equals(repass))) {
                    ConfirmPassword.setError("Passwords do not match !");
                    return;
                }
            }

            private void ValidateUser() {
                String user_type = UserType.getSelectedItem().toString();
                if (!(user_type.contains("Customer") || user_type.contains("Wholesaler") || user_type.contains("Retailer"))) {
                    Toast.makeText(getApplicationContext(), "Please select a valid user", LENGTH_LONG).show();
                    return;
                }
            }


        });


    }

    @SuppressLint("MissingPermission")
    private void getLocation() {

        try {
            locationManager = (LocationManager) getApplicationContext().getSystemService(LOCATION_SERVICE);
            locationManager.requestLocationUpdates(LocationManager.GPS_PROVIDER, 500, 5, RegisterActivity.this);
        } catch (Exception e) {
            e.printStackTrace();
        }


    }

    @Override
    public void onLocationChanged(@NonNull Location location) {

        user_longitude = location.getLongitude();
        user_latitude = location.getLatitude();

        s_long = Double.toString(user_longitude);
        s_lat = Double.toString(user_latitude);


        Longitude_tfield.setText(s_long);
        Latitude_tfield.setText(s_lat);


        try {
            Geocoder geocoder = new Geocoder(RegisterActivity.this, Locale.getDefault());
            List<Address> addresses = geocoder.getFromLocation(location.getLatitude(), location.getLongitude(), 1);
            String address = addresses.get(0).getAddressLine(0);

        } catch (Exception e) {
            e.printStackTrace();
        }

    }

    @Override
    public void onStatusChanged(String provider, int status, Bundle extras) {

    }

    @Override
    public void onProviderEnabled(@NonNull String provider) {

    }

    @Override
    public void onProviderDisabled(@NonNull String provider) {

    }


}


)
(dbfs:/FileStore/LiveMart/Retailer/CategoryAdapter.java,package com.example.oop_project.Main.Retailer;

import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.EditText;
import android.widget.ImageView;
import android.widget.TextView;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;
import androidx.recyclerview.widget.RecyclerView;

import com.bumptech.glide.Glide;
import com.example.oop_project.Main.MyItems.model_items_cat;
import com.example.oop_project.R;
import com.firebase.ui.database.FirebaseRecyclerAdapter;
import com.firebase.ui.database.FirebaseRecyclerOptions;
import com.google.firebase.database.DatabaseError;

public class CategoryAdapter extends FirebaseRecyclerAdapter<model_items_cat, CategoryAdapter.myviewholder> {

    public CategoryAdapter(@NonNull FirebaseRecyclerOptions<model_items_cat> options) {
        super(options);

    }

    @Override
    public void onDataChanged() {
        super.onDataChanged();
    }

    @Override
    public void onError(@NonNull DatabaseError error) {
        super.onError(error);
        error.toException().printStackTrace();
    }


    @Override
    protected void onBindViewHolder(@NonNull myviewholder holder, int position, @NonNull final model_items_cat model) {


        holder.nametext.setText(model.getPname());
        Glide.with(holder.img1.getContext()).load(model.getImage()).into(holder.img1);
        holder.cutdisttext.setVisibility(View.INVISIBLE);
        holder.cutDist.setVisibility(View.INVISIBLE);
        holder.qty.setVisibility(View.INVISIBLE);
        holder.quantlabel.setVisibility(View.INVISIBLE);

//        if(model.getPname().equals("Fruits")) {
//            holder.itemView.setVisibility(View.VISIBLE);
//            }
//            else{
//            holder.itemView.setVisibility(View.GONE);
//        }


        holder.itemView.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {

                AppCompatActivity activity=(AppCompatActivity)view.getContext();
                activity.getSupportFragmentManager().beginTransaction().replace(R.id.container,new RetailerSubCategories(model.getPname())).addToBackStack(null).commit();

            }
        });
    }

    @NonNull
    @Override
    public myviewholder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
        View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.singlerowdesign, parent, false);
        return new myviewholder(view);
    }

    public class myviewholder extends RecyclerView.ViewHolder {
        ImageView img1;
        TextView nametext, qty,quantlabel;
        TextView cutdisttext;
        EditText cutDist;

        public myviewholder(@NonNull View itemView) {
            super(itemView);
            cutdisttext = itemView.findViewById(R.id.cutDisttext);
            cutDist = itemView.findViewById(R.id.cutDist);
            img1 = itemView.findViewById(R.id.img1);
            nametext = itemView.findViewById(R.id.nametext);
            qty = itemView.findViewById(R.id.qtyText);
            quantlabel = itemView.findViewById(R.id.textView5);


        }
    }

}
)
(dbfs:/FileStore/LiveMart/Retailer/OrderAdapter.java,package com.example.oop_project.Main.Retailer;

import android.content.Context;
import android.content.Intent;
import android.content.SharedPreferences;
import android.opengl.Visibility;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Button;
import android.widget.TextView;
import android.widget.Toast;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;
import androidx.recyclerview.widget.RecyclerView;
import com.example.oop_project.Main.FeedbackFrag;
import com.example.oop_project.Main.AlarmActivity;
import com.example.oop_project.R;
import com.firebase.ui.database.FirebaseRecyclerAdapter;
import com.firebase.ui.database.FirebaseRecyclerOptions;
import com.google.firebase.database.DataSnapshot;
import com.google.firebase.database.DatabaseError;
import com.google.firebase.database.DatabaseReference;
import com.google.firebase.database.FirebaseDatabase;
import com.google.firebase.database.ValueEventListener;

public class OrderAdapter extends FirebaseRecyclerAdapter<Orders_sub, OrderAdapter.myviewholder> {
    boolean t;
    public  String cust_uid = "M";
    Context ct;
    public OrderAdapter(@NonNull FirebaseRecyclerOptions<Orders_sub> options,Context c) {
        super(options);
        ct = c;
    }

    @Override
    public void onDataChanged() {
        super.onDataChanged();
    }

    @Override
    public void onError(@NonNull DatabaseError error) {
        super.onError(error);
        error.toException().printStackTrace();
    }


    @Override
    protected void onBindViewHolder(@NonNull myviewholder holder, int position, @NonNull final Orders_sub model) {
        SharedPreferences sh = ct.getSharedPreferences("MySharedPref", Context.MODE_PRIVATE);


        String p_username  =  sh.getString("username","Fgretailer");
        String p_usertype  = sh.getString("usertype","Retailer");
        holder.shop.setText("Wholesaler Name: ");
        holder.pname.setText(model.getPname());
        holder.custname.setText(model.getShop());
        holder.cost.setText(model.getCost());
        holder.ddate.setText(model.getDdate());
        holder.dname.setText(model.getDname());
        holder.dnum.setText(model.getDnumber());
        holder.dqty.setText(model.getQuantity());
        holder.status.setText(model.getStatus());
        holder.bt.setVisibility(View.VISIBLE);
        holder.bt.setOnClickListener(new View.OnClickListener(){
            @Override
            //On click function
            public void onClick(View view) {
                //holder.bt.setVisibility(View.INVISIBLE);
                AppCompatActivity activity=(AppCompatActivity)view.getContext();
                activity.getSupportFragmentManager().beginTransaction().replace(R.id.container,new FeedbackFrag(p_usertype,p_username,model.getPname(),model.getShop())).addToBackStack(null).commit();
            }
        });

        holder.codbtn.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                holder.offbtn.setVisibility(View.INVISIBLE);
                String date = model.getDdate();
                Toast.makeText(ct,"The order will be delivered on " + date,Toast.LENGTH_SHORT).show();

            }
        });
        holder.offbtn.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                holder.codbtn.setVisibility(View.INVISIBLE);
                Intent i = new Intent(ct, AlarmActivity.class);
                ct.startActivity(i);

            }
        });
    }

    @NonNull
    @Override
    public myviewholder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
        View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.transaction_info, parent, false);
        return new myviewholder(view);
    }

    public class myviewholder extends RecyclerView.ViewHolder {
        TextView custname,cost,ddate,dname,dnum,dqty,status,pname,shop;
        Button bt;
        Button codbtn,offbtn;
        public myviewholder(@NonNull View view) {
            super(view);
            bt = (Button) view.findViewById(R.id.addfeedbacks);
            shop = (TextView) view.findViewById(R.id.Custtitle);
            pname = (TextView) view.findViewById(R.id.Titletext);
            custname = (TextView) view.findViewById(R.id.CustName);
            cost = (TextView) view.findViewById(R.id.cost_trans);
            ddate = (TextView) view.findViewById(R.id.deliverydate);
            dname = (TextView) view.findViewById(R.id.deliveryexec);
            dnum = (TextView) view.findViewById(R.id.deliverynum);
            dqty = (TextView) view.findViewById(R.id.quantity_trans);
            status = (TextView) view.findViewById(R.id.stat_trans);
            codbtn = (Button) view.findViewById(R.id.codbutton);
            offbtn = (Button) view.findViewById(R.id.offlinetransact);
        }
    }

})
(dbfs:/FileStore/LiveMart/Retailer/Orders_sub.java,package com.example.oop_project.Main.Retailer;

public class Orders_sub {
    String cost,ddate,dname,dnumber,pname,price,quantity,shop,status;


    public Orders_sub() {
    }

    public Orders_sub(String cost, String ddate, String dname, String dnumber, String pname,String price, String quantity,String shop, String status) {
        this.cost = cost;
        this.pname = pname;
        this.quantity=quantity;
        this.price=price;
        this.shop=shop;
        this.ddate=ddate;
        this.dname=dname;
        this.dnumber=dnumber;
        this.status=status;
    }

    public String getCost() {
        return cost;
    }

    public void setCost(String cost) {
        this.cost = cost;
    }

    public String getDdate() {
        return ddate;
    }

    public void setDdate(String ddate) {
        this.ddate = ddate;
    }

    public String getDname() {
        return dname;
    }

    public void setDname(String dname) {
        this.dname = dname;
    }

    public String getDnumber() {
        return dnumber;
    }

    public void setDnumber(String dnumber) {
        this.dnumber = dnumber;
    }

    public String getPname() {
        return pname;
    }

    public void setPname(String pname) {
        this.pname = pname;
    }

    public String getQuantity() {
        return quantity;
    }

    public void setQuantity(String quantity) {
        this.quantity = quantity;
    }

    public String getStatus() {
        return status;
    }

    public void setStatus(String status) {
        this.status = status;
    }

    public String getPrice() {
        return price;
    }

    public void setPrice(String price) {
        this.price = price;
    }

    public String getShop() {
        return shop;
    }

    public void setShop(String shop) {
        this.shop = shop;
    }
}
)
(dbfs:/FileStore/LiveMart/Retailer/RetailerCategories.java,package com.example.oop_project.Main.Retailer;

import android.content.Context;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;

import androidx.fragment.app.Fragment;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;

import com.example.oop_project.Main.MyItems.model_items_cat;
import com.example.oop_project.R;
import com.firebase.ui.database.FirebaseRecyclerOptions;
import com.google.firebase.database.FirebaseDatabase;

public class RetailerCategories extends Fragment {
    private static final String ARG_PARAM1 = "param1";
    private static final String ARG_PARAM2 = "param2";

    private String mParam1;
    private String mParam2;
    RecyclerView recview;
    CategoryAdapter adapter;
    public String p_username, p_usertype;
    public RetailerCategories() {
//        SharedPreferences sh = context.getSharedPreferences("MySharedPref", Context.MODE_PRIVATE);
//        p_username  = sh.getString("username", "Fgretailer");
//        p_usertype  = sh.getString("usertype", "Retailer");
    }

    public static RetailerCategories newInstance(String param1, String param2) {
        RetailerCategories fragment = new RetailerCategories();
        Bundle args = new Bundle();
        args.putString(ARG_PARAM1, param1);
        args.putString(ARG_PARAM2, param2);
        fragment.setArguments(args);
        return fragment;
    }

    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        if (getArguments() != null) {
            mParam1 = getArguments().getString(ARG_PARAM1);
            mParam2 = getArguments().getString(ARG_PARAM2);
        }
    }

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {

        View view = inflater.inflate(R.layout.categories, container, false);

        recview = (RecyclerView) view.findViewById(R.id.recview);
        Context context = getContext();
        recview.setLayoutManager(new LinearLayoutManager(context));
        FirebaseRecyclerOptions<model_items_cat> options =
                new FirebaseRecyclerOptions.Builder<model_items_cat>()
                        .setQuery(FirebaseDatabase.getInstance().getReference().child("Products").child("Categories"), model_items_cat.class)
                        .build();

        adapter = new CategoryAdapter(options);
        recview.setAdapter(adapter);

        return view;
    }


    @Override
    public void onStart() {
        super.onStart();
        adapter.startListening();
    }

    @Override
    public void onStop() {
        super.onStop();
        adapter.stopListening();
    }
}
)
(dbfs:/FileStore/LiveMart/Retailer/RetailerOrders.java,package com.example.oop_project.Main.Retailer;

import android.content.Intent;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.AdapterView;
import android.widget.ArrayAdapter;
import android.widget.Button;
import android.widget.ListView;

import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.appcompat.app.AppCompatActivity;
import androidx.fragment.app.Fragment;

import com.example.oop_project.Main.AlarmActivity;
import com.example.oop_project.R;

import java.util.ArrayList;

public class RetailerOrders extends Fragment implements AdapterView.OnItemClickListener{
    ArrayList<String> Keys = new ArrayList<>();
    boolean t;
    @Override
    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {
        super.onViewCreated(view, savedInstanceState);
        ListView listview = view.findViewById(R.id.listView);

        ArrayAdapter<String> adapter= new ArrayAdapter<>(getActivity(),R.layout.row,R.id.maintransview,Keys);
        listview.setAdapter(adapter);
        listview.setOnItemClickListener(this);
    }

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        View view = inflater.inflate(R.layout.transaction_layout, container, false);
        Button notifbtn = (Button) view.findViewById(R.id.notifbtn);
        notifbtn.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                Intent i = new Intent(getContext(), AlarmActivity.class);
                getContext().startActivity(i);
            }
        });
        return view;
    }
    public RetailerOrders(ArrayList<String> Keys) {
        this.Keys=Keys;
    }

    @Override
    public void onItemClick(AdapterView<?> parent, View view, int position, long id) {
        String selectedFromList = (String) (parent.getItemAtPosition(position));
        AppCompatActivity activity=(AppCompatActivity)view.getContext();
        activity.getSupportFragmentManager().beginTransaction().replace(R.id.container,new RetailerOrders_sub(selectedFromList)).addToBackStack(null).commit();
    }
}
)
(dbfs:/FileStore/LiveMart/Retailer/RetailerOrders_sub.java,package com.example.oop_project.Main.Retailer;

import android.content.Context;
import android.content.Intent;
import android.content.SharedPreferences;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Button;

import androidx.appcompat.app.AppCompatActivity;
import androidx.fragment.app.Fragment;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;

import com.example.oop_project.Main.AlarmActivity;
import com.example.oop_project.Main.FragmentContent;
import com.example.oop_project.R;
import com.firebase.ui.database.FirebaseRecyclerOptions;
import com.google.firebase.database.FirebaseDatabase;

public class RetailerOrders_sub extends Fragment {

    String pname;
    RecyclerView recview;
    OrderAdapter adapter;
    public RetailerOrders_sub() {

    }

    public RetailerOrders_sub(String pname) {
        this.pname=pname;

    }

    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
    }

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {

        View view=inflater.inflate(R.layout.categories2, container, false);

        SharedPreferences sh = getContext().getSharedPreferences("MySharedPref", Context.MODE_PRIVATE);


        String p_username  =  sh.getString("username","Fgretailer");
        String p_usertype  = sh.getString("usertype","Retailer");

        recview = (RecyclerView) view.findViewById(R.id.recview2);
        recview.setLayoutManager(new LinearLayoutManager(getContext()));

        FirebaseRecyclerOptions<Orders_sub> options =
                new FirebaseRecyclerOptions.Builder<Orders_sub>()
                        .setQuery(FirebaseDatabase.getInstance().getReference().child("Cart").child("Retailer").child(p_username).child(pname)/*.orderByChild("status").equalTo("Approved")*/, Orders_sub.class)
                        .build();
        adapter = new OrderAdapter(options,getContext());
        recview.setAdapter(adapter);


        return  view;
    }

    public void onBackPressed()
    {
        AppCompatActivity activity=(AppCompatActivity)getContext();
        activity.getSupportFragmentManager().beginTransaction().replace(R.id.container,new FragmentContent()).addToBackStack(null).commit();

    }

    @Override
    public void onStart() {
        super.onStart();
        adapter.startListening();
    }

    @Override
    public void onStop() {
        super.onStop();
        adapter.stopListening();
    }
})
(dbfs:/FileStore/LiveMart/Retailer/RetailerShopList.java,package com.example.oop_project.Main.Retailer;

import android.os.Bundle;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Button;
import android.widget.EditText;

import androidx.appcompat.app.AppCompatActivity;
import androidx.fragment.app.Fragment;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;

import com.example.oop_project.R;
import com.firebase.ui.database.FirebaseRecyclerOptions;
import com.google.firebase.database.DatabaseReference;
import com.google.firebase.database.FirebaseDatabase;
import com.google.firebase.database.Query;

public class RetailerShopList extends Fragment{
    double cutDist=1000;
    private static final String ARG_PARAM1 = "param1";
    private static final String ARG_PARAM2 = "param2";

    private String mParam1;
    private String mParam2;
    public double cutoffDistance;
    String catname,pname;
    RecyclerView recview1;
    RetailerShopadapter adapter;
    Button filter;
    double quantity;
    EditText cutoffDist;
    public RetailerShopList() {

    }

    public RetailerShopList(String catname, String pname, double cutDistance,double qty) {
        this.cutoffDistance = cutDistance;
        this.catname = catname;
        this.pname = pname;
        this.quantity = qty;
    }

    public static RetailerShopList newInstance(String param1, String param2) {
        RetailerShopList fragment = new RetailerShopList();
        Bundle args = new Bundle();
        args.putString(ARG_PARAM1, param1);
        args.putString(ARG_PARAM2, param2);
        fragment.setArguments(args);
        return fragment;
    }

    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        if (getArguments() != null) {
            mParam1 = getArguments().getString(ARG_PARAM1).trim();
            mParam2 = getArguments().getString(ARG_PARAM2).trim();
        }

    }

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        View view = inflater.inflate(R.layout.activity_shop_filter, container, false);
        recview1 = (RecyclerView) view.findViewById(R.id.rcycler);
        recview1.setLayoutManager(new LinearLayoutManager(getContext()));
        Log.i("Mine dis", "pname:" + pname);
        Log.i("Mine dis", "catname:" + catname);

        DatabaseReference rootref = FirebaseDatabase.getInstance().getReference();
        Query query = rootref.child("Quantity").child(catname).child(pname).child("Wholesaler");
        //pname = Fruits

        FirebaseRecyclerOptions<RetailerShopModel> options =
                new FirebaseRecyclerOptions.Builder<RetailerShopModel>()
                        .setQuery(query, RetailerShopModel.class)
                        .build();

        adapter = new RetailerShopadapter(options,getContext(),  catname , pname,cutoffDistance,(int) quantity);
        recview1.setAdapter(adapter);


        return view;
    }

    public void onBackPressed() {
        AppCompatActivity activity = (AppCompatActivity) getContext();
        activity.getSupportFragmentManager().beginTransaction().replace(R.id.container, new RetailerSubCategories()).addToBackStack(null).commit();

    }

    @Override
    public void onStart() {
        super.onStart();
        adapter.startListening();

    }

    @Override
    public void onStop() {
        super.onStop();
        adapter.stopListening();
    }
})
(dbfs:/FileStore/LiveMart/Retailer/RetailerShopModel.java,package com.example.oop_project.Main.Retailer;

public class RetailerShopModel {
    String latitude,longitude,price,quantity,rname;
    public RetailerShopModel() {
    }

    public RetailerShopModel(String latitude, String longitude, String price, String quantity, String rname) {
        this.rname = rname;
        this.price = price;
        this.quantity = quantity;
        this.latitude=latitude;
        this.longitude=longitude;
    }

    public String getLatitude() {
        return latitude;
    }

    public void setLatitude(String latitude) {
        this.latitude = latitude;
    }

    public String getLongitude() {
        return longitude;
    }

    public void setLongitude(String longitude) {
        this.longitude = longitude;
    }

    public String getPrice() {
        return price;
    }

    public void setPrice(String price) {
        this.price = price;
    }

    public String getQuantity() {
        return quantity;
    }

    public void setQuantity(String quantity) {
        this.quantity = quantity;
    }

    public String getRname() {
        return rname;
    }

    public void setRname(String rname) {
        this.rname = rname;
    }
})
(dbfs:/FileStore/LiveMart/Retailer/RetailerShopadapter.java,package com.example.oop_project.Main.Retailer;

import android.content.Context;
import android.content.SharedPreferences;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Button;
import android.widget.TextView;
import android.widget.Toast;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;
import androidx.recyclerview.widget.RecyclerView;

import com.example.oop_project.Main.FeedbackDisplay;
import com.example.oop_project.R;
import com.firebase.ui.database.FirebaseRecyclerAdapter;
import com.firebase.ui.database.FirebaseRecyclerOptions;
import com.google.firebase.database.DataSnapshot;
import com.google.firebase.database.DatabaseError;
import com.google.firebase.database.DatabaseReference;
import com.google.firebase.database.FirebaseDatabase;
import com.google.firebase.database.ValueEventListener;

import java.text.DecimalFormat;
import java.util.HashMap;
import java.util.Map;


public class RetailerShopadapter extends FirebaseRecyclerAdapter<RetailerShopModel, RetailerShopadapter.myviewholder>  {
    public String arg_cat,arg_pname,p_username,p_usertype, dist_temp,parent_usertype;
    public double cutoffDist;
    // category , product name
    int quantity;
    public String fbtext="NO";
    public String source;
    public String uid;
    Context context;

    public RetailerShopadapter(@NonNull FirebaseRecyclerOptions<RetailerShopModel> options, Context context, String catname , String pname, double cutDist,int qty) {
        super(options);
        SharedPreferences sh = context.getSharedPreferences("MySharedPref", Context.MODE_PRIVATE);

        // The value will be default as empty string because for
// the very first time when the app is opened, there is nothing to show
        p_username  =  sh.getString("username","Fgretailer");
        p_usertype  = sh.getString("usertype","Retailer");
        arg_cat=catname;
        arg_pname=pname;
        cutoffDist = cutDist;
        quantity = qty;
        this.context=context;

    }

    @Override
    public void onDataChanged() {
        super.onDataChanged();
    }

    @Override
    public void onError(@NonNull DatabaseError error) {
        super.onError(error);
        error.toException().printStackTrace();
    }
    private double distance(double lat1, double lon1, double lat2, double lon2) {
        double theta = lon1 - lon2;
        double dist = Math.sin(deg2rad(lat1))
                * Math.sin(deg2rad(lat2))
                + Math.cos(deg2rad(lat1))
                * Math.cos(deg2rad(lat2))
                * Math.cos(deg2rad(theta));
        dist = Math.acos(dist);
        dist = rad2deg(dist);
        dist = dist * 60 * 1.1515;
        return (dist/1000);

    }
    private double deg2rad(double deg) {
        return (deg * Math.PI / 180.0);
    }

    private double rad2deg(double rad) {
        return (rad * 180.0 / Math.PI);
    }
    @Override
    protected void onBindViewHolder(@NonNull myviewholder holder, int position, @NonNull final RetailerShopModel model) {
        Log.i("memes",arg_pname);
        Log.i("memes",p_username);
        Log.i("memes",p_usertype);
        Log.i("subra",model.getRname());
        Log.i("subra",model.getQuantity());
        Log.i("subra",model.getPrice());
        holder.shopname.setText(model.getRname());
        holder.qty.setText(model.getQuantity());
        holder.rate.setText(model.getPrice());
        holder.tc.setText(Float.toString(Float.parseFloat(model.getPrice())* Integer.parseInt(model.getQuantity())));
        if(quantity != 0) {
            holder.tc.setText(Float.toString(Float.parseFloat(model.getPrice()) *quantity));
        }
        else {
            holder.tc.setError("Please enter quantity!");
        }
        final FirebaseDatabase database = FirebaseDatabase.getInstance();
        DatabaseReference dbref = database.getReference().child("User");
        DatabaseReference db = FirebaseDatabase.getInstance().getReference();
        holder.b2.setOnClickListener(new View.OnClickListener(){
            @Override
            //On click function
            public void onClick(View view) {
                if(p_usertype.equals("Customer")){
                    source = "Retailer";
                }else if(p_usertype.equals("Retailer")){
                    source = "Wholesaler";
                }
                db.child("Feedback").child(source).child(model.getRname()).child(arg_pname).child(p_username).addValueEventListener(new ValueEventListener() {
                    @Override
                    public void onDataChange(DataSnapshot snapshot) {
                        if(snapshot.exists()) {
                            String retname=model.getRname();

                            fbtext = "By "+p_username+": \n"+snapshot.child("feedback").getValue().toString();

                            //db.child("Cart").child("Customer").child("Macha").child(uid).child(arg_pname).setValue(map);

                        }else{
                            fbtext = "NO FEEDBACK FOR THIS ITEM YET";
                        }
                        AppCompatActivity activity=(AppCompatActivity)view.getContext();
                        activity.getSupportFragmentManager().beginTransaction().replace(R.id.container,new FeedbackDisplay(fbtext)).addToBackStack(null).commit();

                    }

                    @Override
                    public void onCancelled(DatabaseError databaseError) {

                    }
                });

            }
        });
        holder.b1.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                if(true) {
                    dbref.addValueEventListener(new ValueEventListener() {
                        @Override
                        public void onDataChange(DataSnapshot snapshot) {
                            if(snapshot.exists()) {
                                String shop_name = (String) holder.shopname.getText();
                                uid = snapshot.child("Retailer").child(p_username).child("Details").child("UID").getValue().toString();
                                Map<String, Object> map = new HashMap<>();
                                map.put("pname", arg_pname);
                                map.put("cost", holder.tc.getText());
                                map.put("quantity", String.valueOf(quantity));
                                map.put("shop", holder.shopname.getText());
                                map.put("dname", "Rajesh");
                                map.put("ddate", "2/7/21");
                                Log.i("Brux","kdnsk");
                                map.put("dnumber", "99876");
                                map.put("status", "Approved");
                                DatabaseReference db = FirebaseDatabase.getInstance().getReference();
                                db.child("Cart").child("Retailer").child(p_username).child(uid).child(arg_pname).updateChildren(map);

                                Map<String, Object> mapa = new HashMap<>();
                                mapa.put("pname", arg_pname);
                                mapa.put("cost", holder.tc.getText());
                                mapa.put("quantity", String.valueOf(quantity));
                                mapa.put("username", p_username);
                                mapa.put("dname", "daboi");
                                mapa.put("ddate", "1/6/21");
                                Log.i("Brux","kdnsk");
                                mapa.put("dnumber", "67564");
                                mapa.put("status", "Approved");
                                DatabaseReference dba = FirebaseDatabase.getInstance().getReference();

                                dba.child("Transaction").child("Wholesaler").child(shop_name).child(uid).child(arg_pname).updateChildren(mapa);

                                Toast.makeText(context, arg_pname+" was added to "+uid, Toast.LENGTH_SHORT).show();

                                //db.child("Cart").child("Retailer").child(p_username).child(uid).child(arg_pname).setValue(map);

                            }

                        }

                        @Override
                        public void onCancelled(DatabaseError databaseError) {

                        }
                    });

                }

            }
        });
//        holder.b1.setOnClickListener(new View.OnClickListener() {
//            @Override
//            public void onClick(View v) {
//                double qty = quantity + Double.parseDouble(String.valueOf(holder.qty.getText()));
//                Map<String, Object> Retmap = new HashMap<>();
//                Retmap.put("pname", arg_pname);
//                Retmap.put("price", holder.tc.getText());
//                Retmap.put("quantity", String.valueOf(qty));
//                Log.i("Brick","kdnsk");
//                Retmap.put("shop", holder.shopname.getText());
//                Retmap.put("dname", "daboi");
//                Retmap.put("ddate", "1/6/21");
//                Retmap.put("dnumber", "6969696969");
//                DatabaseReference db = FirebaseDatabase.getInstance().getReference();
//                db.child("Cart").child(p_usertype).child(p_username).child("UID_1").child(arg_pname).updateChildren(Retmap);
//            }
//        });
        dbref.addValueEventListener(new ValueEventListener() {
            @Override
            public void onDataChange(DataSnapshot snapshot) {
                if(snapshot.exists()){
                    String str1 = snapshot.child(p_usertype).child(p_username).child("Details").child("latitude").getValue().toString();
                    Log.e("memes", str1);
                    String str2= snapshot.child(p_usertype).child(p_username).child("Details").child("longitude").getValue().toString();
                    Log.e("memes", str2);
                    Log.i("status","random");
                    if(p_usertype.equals("Customer")){
                        parent_usertype="Retailer";
                    }else{
                        parent_usertype="Wholesaler";
                    }
                    Log.i("status",parent_usertype);
                    String str3 = snapshot.child(parent_usertype).child(model.getRname()).child("Details").child("latitude").getValue().toString();
                    String str4 = snapshot.child(parent_usertype).child(model.getRname()).child("Details").child("longitude").getValue().toString();
                    double lat1,lat2,lon1,lon2;
                    lat1 = Double.parseDouble(str1);
                    lat2 = Double.parseDouble(str3);
                    lon1 = Double.parseDouble(str2);
                    lon2 = Double.parseDouble(str4);
                    String str = new DecimalFormat("#.00#").format(distance(lat1,lon1,lat2,lon2));
                    holder.dist.setText(str);
                    double activeDist = Double.parseDouble(str);
                    if(activeDist>cutoffDist){
                        holder.itemView.setVisibility(View.INVISIBLE);
                        Log.i("Dist","DS1 does not exist");
                    }
                    else {
                        holder.itemView.setVisibility(View.VISIBLE);
                    }
                }else{
                    Log.i("memes","DS1 does not exist");
                }

            }

            @Override
            public void onCancelled(DatabaseError databaseError) {

            }
        });

////        lat2 = Double.parseDouble(String.valueOf(database.getReference().child("User").child("Retailer").child(model.getRname()).child("Details").child("latitude").get()));
////        lon2 = Double.parseDouble(String.valueOf(database.getReference().child("User").child("Retailer").child(model.getRname()).child("Details").child("longitude").get()));
////        Log.e("distance: ", Double.toString(distance(lat1,lon1,lat2,lon2)));





            // to retrieve the coordinates from the user
            // retrieve coordinates from the shop
            // calculate distance



            //display details


        FirebaseDatabase.getInstance().getReference().child("Quantity").child(arg_cat).child(arg_pname);







        //Glide.with(holder.img1.getContext()).load().into(holder.img1);
        //add text and image based on layout ani designs
//        holder.img1.setOnClickListener(new View.OnClickListener() {
//            @Override
//            public void onClick(View view) {
//                AppCompatActivity activity=(AppCompatActivity)view.getContext();
//                activity.getSupportFragmentManager().beginTransaction().replace(R.id.container,new CustomerShopList()).addToBackStack(null).commit();
//            }
//        });
    }

    @NonNull
    @Override
    public myviewholder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
        View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.filter_row, parent, false);
        return new myviewholder(view);
    }

    public class myviewholder extends RecyclerView.ViewHolder {
        //modify this based on what ani designs
        TextView shopname,qty,rate,tc,dist;
        Button b1,b2 ;
        public myviewholder(@NonNull View itemView) {
            super(itemView);

            this.itemView.getContext();
            int a =1;
            b2 = itemView.findViewById(R.id.feedbackbtn);
            b1 = itemView.findViewById(R.id.addtocartbtn);
            shopname = itemView.findViewById(R.id.shopnameTV);
            qty = itemView.findViewById(R.id.qtyTV);
            rate = itemView.findViewById(R.id.rateTV);
            tc = itemView.findViewById(R.id.totalcostTV);
            dist = itemView.findViewById(R.id.distTV);


        }
    }
}
)
(dbfs:/FileStore/LiveMart/Retailer/RetailerSubCategories.java,package com.example.oop_project.Main.Retailer;

import android.os.Bundle;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;

import androidx.appcompat.app.AppCompatActivity;
import androidx.fragment.app.Fragment;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;

import com.example.oop_project.Main.Customer.model_subcategory;
import com.example.oop_project.R;
import com.firebase.ui.database.FirebaseRecyclerOptions;
import com.google.firebase.database.FirebaseDatabase;

public class RetailerSubCategories extends Fragment {

    private static final String ARG_PARAM1 = "param1";
    private static final String ARG_PARAM2 = "param2";

    private String mParam1;
    private String mParam2;
    String pname;

    RecyclerView recview;
    SubCategoryAdapter adapter;
    public RetailerSubCategories() {

    }

    public RetailerSubCategories(String pname) {
        this.pname=pname;

    }

    public static RetailerSubCategories newInstance(String param1, String param2) {
        RetailerSubCategories fragment = new RetailerSubCategories();
        Bundle args = new Bundle();
        args.putString(ARG_PARAM1, param1);
        args.putString(ARG_PARAM2, param2);
        fragment.setArguments(args);
        return fragment;
    }

    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        if (getArguments() != null) {
            mParam1 = getArguments().getString(ARG_PARAM1);
            mParam2 = getArguments().getString(ARG_PARAM2);
        }
    }

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {

        View view=inflater.inflate(R.layout.categories2, container, false);

        recview = (RecyclerView) view.findViewById(R.id.recview2);
        recview.setLayoutManager(new LinearLayoutManager(getContext()));
        Log.i("thistest",pname);
        FirebaseRecyclerOptions<model_subcategory> options =
                new FirebaseRecyclerOptions.Builder<model_subcategory>()
                        .setQuery(FirebaseDatabase.getInstance().getReference().child("Products").child(pname).orderByChild("status").equalTo("Approved"), model_subcategory.class)
                        .build();
        adapter = new SubCategoryAdapter(options,pname);
        recview.setAdapter(adapter);


        return  view;
    }

    public void onBackPressed()
    {
        AppCompatActivity activity=(AppCompatActivity)getContext();
        activity.getSupportFragmentManager().beginTransaction().replace(R.id.container,new RetailerCategories()).addToBackStack(null).commit();

    }

    @Override
    public void onStart() {
        super.onStart();
        adapter.startListening();
    }

    @Override
    public void onStop() {
        super.onStop();
        adapter.stopListening();
    }
})
(dbfs:/FileStore/LiveMart/Retailer/RetailerTrans.java,package com.example.oop_project.Main.Retailer;

import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.AdapterView;
import android.widget.ArrayAdapter;
import android.widget.ListView;

import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.appcompat.app.AppCompatActivity;
import androidx.fragment.app.Fragment;

import com.example.oop_project.R;

import java.util.ArrayList;

public class RetailerTrans extends Fragment implements AdapterView.OnItemClickListener{
    ArrayList<String> Keys = new ArrayList<>();
    boolean t;
    @Override
    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {
        super.onViewCreated(view, savedInstanceState);
        ListView listview = view.findViewById(R.id.listView);

        ArrayAdapter<String> adapter= new ArrayAdapter<>(getActivity(),R.layout.row,R.id.maintransview,Keys);
        listview.setAdapter(adapter);
        listview.setOnItemClickListener(this);
    }

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        View view = inflater.inflate(R.layout.transaction_layout, container, false);
        return view;
    }
    public RetailerTrans(ArrayList<String> Keys,boolean t) {
        this.Keys=Keys;
        this.t=t;
    }

    @Override
    public void onItemClick(AdapterView<?> parent, View view, int position, long id) {
        String selectedFromList = (String) (parent.getItemAtPosition(position));
        AppCompatActivity activity=(AppCompatActivity)view.getContext();
        activity.getSupportFragmentManager().beginTransaction().replace(R.id.container,new RetailerTrans_sub(selectedFromList,t)).addToBackStack(null).commit();
    }
}
)
(dbfs:/FileStore/LiveMart/Retailer/RetailerTrans_sub.java,package com.example.oop_project.Main.Retailer;

import android.content.Context;
import android.content.SharedPreferences;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;

import androidx.appcompat.app.AppCompatActivity;
import androidx.fragment.app.Fragment;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;

import com.example.oop_project.Main.FragmentContent;
import com.example.oop_project.R;
import com.firebase.ui.database.FirebaseRecyclerOptions;
import com.google.firebase.database.FirebaseDatabase;

public class RetailerTrans_sub extends Fragment {

    String pname,p_username,p_usertype;

    RecyclerView recview;
    TransactionAdapter adapter;
    boolean t;
    public RetailerTrans_sub() {

    }

    public RetailerTrans_sub(String pname,boolean t) {
        this.pname=pname;
        this.t=t;

    }

    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
    }

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {

        SharedPreferences sh = getContext().getSharedPreferences("MySharedPref", Context.MODE_PRIVATE);
        p_username  = sh.getString("username", "Fgretailer");
        p_usertype  = sh.getString("usertype", "Retailer");

        View view=inflater.inflate(R.layout.categories2, container, false);

        recview = (RecyclerView) view.findViewById(R.id.recview2);
        recview.setLayoutManager(new LinearLayoutManager(getContext()));

        FirebaseRecyclerOptions<TransModel_sub> options =
                new FirebaseRecyclerOptions.Builder<TransModel_sub>()
                        .setQuery(FirebaseDatabase.getInstance().getReference().child("Transaction").child("Retailer").child(p_username).child(pname), TransModel_sub.class)
                        .build();
        adapter = new TransactionAdapter(options,t);
        recview.setAdapter(adapter);


        return  view;
    }

    public void onBackPressed()
    {
        AppCompatActivity activity=(AppCompatActivity)getContext();
        activity.getSupportFragmentManager().beginTransaction().replace(R.id.container,new FragmentContent()).addToBackStack(null).commit();

    }

    @Override
    public void onStart() {
        super.onStart();
        adapter.startListening();
    }

    @Override
    public void onStop() {
        super.onStop();
        adapter.stopListening();
    }
})
(dbfs:/FileStore/LiveMart/Retailer/SubCategoryAdapter.java,package com.example.oop_project.Main.Retailer;

import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.EditText;
import android.widget.ImageView;
import android.widget.TextView;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;
import androidx.recyclerview.widget.RecyclerView;

import com.bumptech.glide.Glide;
import com.example.oop_project.Main.Customer.model_subcategory;
import com.example.oop_project.R;
import com.firebase.ui.database.FirebaseRecyclerAdapter;
import com.firebase.ui.database.FirebaseRecyclerOptions;
import com.google.firebase.database.DatabaseError;

public class SubCategoryAdapter extends FirebaseRecyclerAdapter<model_subcategory, SubCategoryAdapter.myviewholder> {
    String catname;
    public SubCategoryAdapter(@NonNull FirebaseRecyclerOptions<model_subcategory> options, String category) {
        super(options);
        catname=category;
    }

    @Override
    public void onDataChanged() {
        super.onDataChanged();
    }

    @Override
    public void onError(@NonNull DatabaseError error) {
        super.onError(error);
        error.toException().printStackTrace();
    }


    @Override
    protected void onBindViewHolder(@NonNull myviewholder holder, int position, @NonNull final model_subcategory model) {
        holder.nametext.setText(model.getPname());
        Glide.with(holder.img1.getContext()).load(model.getImage()).into(holder.img1);
        holder.cutdisttext.setVisibility(View.VISIBLE);
        holder.cutDist.setVisibility(View.VISIBLE);
        holder.itemView.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                double cutDist=1000;
                int qty;
                if(holder.qty.getText().toString().matches("")){
                    qty=0;
                }else {
                    qty = Integer.parseInt(holder.qty.getText().toString());
                }
                if(holder.cutDist.getText().length() != 0){
                    cutDist = Double.parseDouble(String.valueOf(holder.cutDist.getText()));
                }
                AppCompatActivity activity=(AppCompatActivity)view.getContext();
                activity.getSupportFragmentManager().beginTransaction().replace(R.id.container,new RetailerShopList(catname,model.getPname(),cutDist,qty)).addToBackStack(null).commit();
                Log.i("mine sub",catname +" hello "+model.getPname());
            }
        });
    }

    @NonNull
    @Override
    public myviewholder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
        View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.singlerowdesign, parent, false);
        return new myviewholder(view);
    }

    public class myviewholder extends RecyclerView.ViewHolder {
        ImageView img1;
        TextView nametext;
        TextView cutdisttext;
        EditText cutDist,qty;
        public myviewholder(@NonNull View itemView) {
            super(itemView);
            cutdisttext = itemView.findViewById(R.id.cutDisttext);
            cutDist = itemView.findViewById(R.id.cutDist);
            img1 = itemView.findViewById(R.id.img1);
            nametext = itemView.findViewById(R.id.nametext);
            qty = itemView.findViewById(R.id.qtyText);
        }
    }

}
)
(dbfs:/FileStore/LiveMart/Retailer/TransModel.java,package com.example.oop_project.Main.Retailer;

public class TransModel {
    TransModel_sub t;
    public TransModel() {
    }

    public TransModel(TransModel_sub t) {
        this.t=t;
    }

    public TransModel_sub getT() {
        return t;
    }

    public void setT(TransModel_sub t) {
        this.t = t;
    }
}
)
(dbfs:/FileStore/LiveMart/Retailer/TransModel_sub.java,package com.example.oop_project.Main.Retailer;

public class TransModel_sub  {
    String cost,ddate,dname,dnumber,pname,quantity,status,username;


    public TransModel_sub() {
    }

    public TransModel_sub(String cost,String ddate,String dname,String dnumber,String pname,String quantity,String status,String username) {
        this.cost = cost;
        this.pname = pname;
        this.quantity=quantity;
        this.username=username;
        this.ddate=ddate;
        this.dname=dname;
        this.dnumber=dnumber;
        this.status=status;
    }

    public String getCost() {
        return cost;
    }

    public void setCost(String cost) {
        this.cost = cost;
    }

    public String getDdate() {
        return ddate;
    }

    public void setDdate(String ddate) {
        this.ddate = ddate;
    }

    public String getDname() {
        return dname;
    }

    public void setDname(String dname) {
        this.dname = dname;
    }

    public String getDnumber() {
        return dnumber;
    }

    public void setDnumber(String dnumber) {
        this.dnumber = dnumber;
    }

    public String getPname() {
        return pname;
    }

    public void setPname(String pname) {
        this.pname = pname;
    }

    public String getQuantity() {
        return quantity;
    }

    public void setQuantity(String quantity) {
        this.quantity = quantity;
    }

    public String getStatus() {
        return status;
    }

    public void setStatus(String status) {
        this.status = status;
    }

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }
}
)
(dbfs:/FileStore/LiveMart/Retailer/TransactionAdapter.java,package com.example.oop_project.Main.Retailer;

import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Button;
import android.widget.TextView;

import androidx.annotation.NonNull;
import androidx.recyclerview.widget.RecyclerView;

import com.example.oop_project.R;
import com.firebase.ui.database.FirebaseRecyclerAdapter;
import com.firebase.ui.database.FirebaseRecyclerOptions;
import com.google.firebase.database.DatabaseError;

public class TransactionAdapter extends FirebaseRecyclerAdapter<com.example.oop_project.Main.Retailer.TransModel_sub, TransactionAdapter.myviewholder> {
    boolean t;
    public TransactionAdapter(@NonNull FirebaseRecyclerOptions<com.example.oop_project.Main.Retailer.TransModel_sub> options, boolean t) {
        super(options);
        this.t=t;
    }

    @Override
    public void onDataChanged() {
        super.onDataChanged();
    }

    @Override
    public void onError(@NonNull DatabaseError error) {
        super.onError(error);
        error.toException().printStackTrace();
    }


    @Override
    protected void onBindViewHolder(@NonNull myviewholder holder, int position, @NonNull final TransModel_sub model) {
        if(t){
            holder.shop.setText("Retailer Name: ");
        }else{
            holder.shop.setText("Customer Name: ");
        }
        holder.pname.setText(model.getPname());
        holder.custname.setText(model.getUsername());
        holder.cost.setText(model.getCost());
        holder.ddate.setText(model.getDdate());
        holder.dname.setText(model.getDname());
        holder.dnum.setText(model.getDnumber());
        holder.dqty.setText(model.getQuantity());
        holder.status.setText(model.getStatus());
        holder.offline.setVisibility(View.INVISIBLE);
        holder.COD.setVisibility(View.INVISIBLE);
    }

    @NonNull
    @Override
    public myviewholder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
        View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.transaction_info, parent, false);
        return new myviewholder(view);
    }

    public class myviewholder extends RecyclerView.ViewHolder {
        TextView custname,cost,ddate,dname,dnum,dqty,status,pname,shop;
        Button COD,offline;
        public myviewholder(@NonNull View view) {
            super(view);
            shop = (TextView) view.findViewById(R.id.Custtitle);
            pname = (TextView) view.findViewById(R.id.Titletext);
            custname = (TextView) view.findViewById(R.id.CustName);
            cost = (TextView) view.findViewById(R.id.cost_trans);
            ddate = (TextView) view.findViewById(R.id.deliverydate);
            dname = (TextView) view.findViewById(R.id.deliveryexec);
            dnum = (TextView) view.findViewById(R.id.deliverynum);
            dqty = (TextView) view.findViewById(R.id.quantity_trans);
            status = (TextView) view.findViewById(R.id.stat_trans);
            COD = view.findViewById(R.id.codbutton);
            offline = view.findViewById(R.id.offlinetransact);

        }
    }

}
)
(dbfs:/FileStore/LiveMart/SendOTPActivity.java,package com.example.oop_project.Main;

import androidx.appcompat.app.AppCompatActivity;

import android.content.Context;
import android.content.Intent;
import android.content.SharedPreferences;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.ProgressBar;
import android.widget.Toast;

import com.example.oop_project.R;

public class SendOTPActivity extends AppCompatActivity {

    private String user_type;



    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_entermobilenumber);

        final EditText inputMobile = findViewById(R.id.phone_number);
        Button buttonGetOTP = findViewById(R.id.get_otp);
        ProgressBar progressBar = findViewById(R.id.progressbar_sendotp);


        buttonGetOTP.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {


                if (inputMobile.getText().toString().isEmpty()) {


//                    SharedPreferences sh = getApplicationContext().getSharedPreferences("MySharedPref", Context.MODE_PRIVATE);
//
//                    // The value will be default as empty string because for
//// the very first time when the app is opened, there is nothing to show
//                    String p_username = sh.getString("username", "Macha");
//                    String p_usertype = sh.getString("usertype", "Customer");
//
//// We can then use the data
//
//                    Toast.makeText(SendOTPActivity.this, p_username, Toast.LENGTH_SHORT).show();
                    Toast.makeText(SendOTPActivity.this, "Enter the number please!", Toast.LENGTH_SHORT).show();


                } else if (inputMobile.getText().toString().trim().length()!=10){
                    Toast.makeText(SendOTPActivity.this, "Enter a 10 digit number please!", Toast.LENGTH_SHORT).show();

                }

//
//                {
//                    PhoneAuthProvider.getInstance().verifyPhoneNumber(
//                            "+91" + inputMobile.getText().toString().trim(),
//                            60,
//                            TimeUnit.SECONDS,
//                            SendOTPActivity.this,
//                            new PhoneAuthProvider.OnVerificationStateChangedCallbacks() {
//                                @Override
//                                public void onVerificationCompleted(@NonNull PhoneAuthCredential phoneAuthCredential) {
//                                    progressBar.setVisibility(View.GONE);
//                                    buttonGetOTP.setVisibility(View.VISIBLE);
//                                }
//
//                                @Override
//                                public void onVerificationFailed(@NonNull FirebaseException e) {
//                                    progressBar.setVisibility(View.GONE);
//                                    buttonGetOTP.setVisibility(View.VISIBLE);
//                                    Toast.makeText(getApplicationContext(), e.getMessage(), Toast.LENGTH_SHORT).show();
//                                }
//
//                                @Override
//                                public void onCodeSent(@NonNull String verificationId, @NonNull PhoneAuthProvider.ForceResendingToken forceResendingToken) {
//                                    progressBar.setVisibility(View.GONE);
//                                    buttonGetOTP.setVisibility(View.VISIBLE);
//                                    Intent intent = new Intent(SendOTPActivity.this, verifyenterotptwo.class);
//                                    intent.putExtra("mobile", inputMobile.getText().toString().trim());
//                                    intent.putExtra("verificationId", verificationId);
//                                    startActivity(intent);
//
//                                }
//                            }
//
//                    );
//                }

                user_type = getIntent().getStringExtra("user type");

                Intent intent = new Intent(getApplicationContext(), VerifyOTPActivity.class);
                intent.putExtra("mobile", inputMobile.getText().toString().trim());
                startActivity(intent);
            }
        });
    }
})
(dbfs:/FileStore/LiveMart/VerifyOTPActivity.java,package com.example.oop_project.Main;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;

import android.content.Intent;
import android.os.Bundle;
import android.text.Editable;
import android.text.TextWatcher;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.ProgressBar;
import android.widget.TextView;
import android.widget.Toast;

import com.example.oop_project.R;
import com.google.firebase.FirebaseException;
import com.google.firebase.auth.PhoneAuthCredential;
import com.google.firebase.auth.PhoneAuthProvider;

import java.util.concurrent.TimeUnit;

public class VerifyOTPActivity extends AppCompatActivity {


    private EditText iptn1, iptn2, iptn3, iptn4, iptn5, iptn6;
    TextView tview;
    private String verificationId;

    @Override
    protected void onCreate(Bundle savedInstanceState) {

        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_verifyenterotptwo);

        iptn1 = findViewById(R.id.inputotp1);
        iptn2 = findViewById(R.id.inputotp2);
        iptn3 = findViewById(R.id.inputotp3);
        iptn4 = findViewById(R.id.inputotp4);
        iptn5 = findViewById(R.id.inputotp5);
        iptn6 = findViewById(R.id.inputotp6);

        setupOTPInputs();

        final ProgressBar progressBar = findViewById(R.id.progressbar_verifyotp);
        final Button buttonVerify = findViewById(R.id.verify_otp);

        verificationId = getIntent().getStringExtra("verificationId");

        buttonVerify.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                if (iptn1.getText().toString().trim().isEmpty() || iptn2.getText().toString().trim().isEmpty() || iptn3.getText().toString().trim().isEmpty() || iptn4.getText().toString().trim().isEmpty() || iptn5.getText().toString().trim().isEmpty() || iptn6.getText().toString().trim().isEmpty()) {
                    Toast.makeText(getApplicationContext(), "Please enter the OTP properly!", Toast.LENGTH_SHORT).show();
                    return;
                }
                String code = iptn1.getText().toString() +
                        iptn2.getText().toString() +
                        iptn3.getText().toString() +
                        iptn4.getText().toString() +
                        iptn5.getText().toString() +
                        iptn6.getText().toString();

                if (code.contains("842403") ||
                        code.contains("059169") || code.contains("437652") || code.contains("987532") || code.contains("182053") || code.contains("103834") || code.contains("720789")) {
                    Intent intent = new Intent(VerifyOTPActivity.this, NavigationBar.class);
                    intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);
                    startActivity(intent);
                } else {
                    Toast.makeText(VerifyOTPActivity.this, "Enter the correct OTP please", Toast.LENGTH_SHORT).show();
                }
            }
        });


        tview = findViewById(R.id.textmobileshow);

        tview.setText(String.format(
                "+91-%s", getIntent().getStringExtra("mobile")
        ));

        findViewById(R.id.resend_otp).setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {

                PhoneAuthProvider.getInstance().verifyPhoneNumber(
                        "+91" + getIntent().getStringExtra("mobile"),
                        60,
                        TimeUnit.SECONDS,
                        VerifyOTPActivity.this,
                        new PhoneAuthProvider.OnVerificationStateChangedCallbacks() {
                            @Override
                            public void onVerificationCompleted(@NonNull PhoneAuthCredential phoneAuthCredential) {

                            }

                            @Override
                            public void onVerificationFailed(@NonNull FirebaseException e) {

                                Toast.makeText(getApplicationContext(), e.getMessage(), Toast.LENGTH_SHORT).show();
                            }

                            @Override
                            public void onCodeSent(@NonNull String newVerificationid, @NonNull PhoneAuthProvider.ForceResendingToken forceResendingToken) {

                                verificationId = newVerificationid;
                                Toast.makeText(VerifyOTPActivity.this, "OTP sent successfully", Toast.LENGTH_SHORT).show();

                            }
                        }

                );

            }
        });
    }

    private void setupOTPInputs() {

        iptn1.addTextChangedListener(new TextWatcher() {
            @Override
            public void beforeTextChanged(CharSequence s, int start, int count, int after) {

            }

            @Override
            public void onTextChanged(CharSequence s, int start, int before, int count) {
                if (!s.toString().trim().isEmpty()) {
                    iptn2.requestFocus();
                }
            }

            @Override
            public void afterTextChanged(Editable s) {

            }
        });

        iptn2.addTextChangedListener(new TextWatcher() {
            @Override
            public void beforeTextChanged(CharSequence s, int start, int count, int after) {

            }

            @Override
            public void onTextChanged(CharSequence s, int start, int before, int count) {
                if (!s.toString().trim().isEmpty()) {
                    iptn3.requestFocus();
                }
            }

            @Override
            public void afterTextChanged(Editable s) {

            }
        });

        iptn3.addTextChangedListener(new TextWatcher() {
            @Override
            public void beforeTextChanged(CharSequence s, int start, int count, int after) {

            }

            @Override
            public void onTextChanged(CharSequence s, int start, int before, int count) {
                if (!s.toString().trim().isEmpty()) {
                    iptn4.requestFocus();
                }
            }

            @Override
            public void afterTextChanged(Editable s) {

            }
        });

        iptn4.addTextChangedListener(new TextWatcher() {
            @Override
            public void beforeTextChanged(CharSequence s, int start, int count, int after) {

            }

            @Override
            public void onTextChanged(CharSequence s, int start, int before, int count) {
                if (!s.toString().trim().isEmpty()) {
                    iptn5.requestFocus();
                }
            }

            @Override
            public void afterTextChanged(Editable s) {

            }
        });

        iptn5.addTextChangedListener(new TextWatcher() {
            @Override
            public void beforeTextChanged(CharSequence s, int start, int count, int after) {

            }

            @Override
            public void onTextChanged(CharSequence s, int start, int before, int count) {
                if (!s.toString().trim().isEmpty()) {
                    iptn6.requestFocus();
                }
            }

            @Override
            public void afterTextChanged(Editable s) {

            }
        });


    }

})
(dbfs:/FileStore/LiveMart/Wholesaler_Add.java,package com.example.oop_project.Main;

import android.content.Intent;
import android.os.Bundle;

import androidx.fragment.app.Fragment;

import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Button;

import com.example.oop_project.R;


public class Wholesaler_Add extends Fragment {

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        // Inflate the layout for this fragment
        View view = inflater.inflate(R.layout.fragment_wholesaler__add, container, false);

        Button addprodnoimage,addprodimage;
        addprodimage = view.findViewById(R.id.addprod);
        addprodnoimage = view.findViewById(R.id.addprodnoimage);

        addprodimage.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                Intent intent = new Intent(getActivity(), com.example.oop_project.Main.addproduct.class);
                startActivity(intent);
            }
        });

        addprodnoimage.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                Intent intent = new Intent(getActivity(), com.example.oop_project.Main.addprodnoimage.class);
                startActivity(intent);
            }
        });

        return view;
    }
})
(dbfs:/FileStore/LiveMart/addprodnoimage.java,package com.example.oop_project.Main;

import android.content.Context;
import android.content.Intent;
import android.content.SharedPreferences;
import android.net.Uri;
import android.os.Bundle;
import android.text.TextUtils;
import android.util.Log;
import android.view.View;
import android.widget.ArrayAdapter;
import android.widget.Button;
import android.widget.ImageView;
import android.widget.Spinner;
import android.widget.TextView;
import android.widget.Toast;

import androidx.annotation.Nullable;
import androidx.appcompat.app.AppCompatActivity;

import com.example.oop_project.R;
import com.google.firebase.database.DatabaseReference;
import com.google.firebase.database.FirebaseDatabase;

import java.util.HashMap;

public class addprodnoimage extends AppCompatActivity {

    private String quantity, Price, Pname, p_username, nkey, category, temp_quantity;
    private ImageView InputProductImage;
    private static final int GalleryPick = 1;
    private Uri ImageUri;
    private Button AddNewProductButton;
    private TextView pname, pquantity, pprice;

    private DatabaseReference ProductsRef, UserData, Quantdata;
    private Spinner product_type;


    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.addnoimage);


        {
            SharedPreferences sh = getApplicationContext().getSharedPreferences("MySharedPref", Context.MODE_PRIVATE);

            // The value will be default as empty string because for
// the very first time when the app is opened, there is nothing to show
            p_username = sh.getString("username", "Babuwhole");
            Log.i("memes", p_username);
// We can then use the data
        }//SharedPrefs

        InputProductImage = findViewById(R.id.select_product_image);
        AddNewProductButton = findViewById(R.id.add_new_product);
        pname = findViewById(R.id.product_name);
        pprice = findViewById(R.id.product_price);
        pquantity = findViewById(R.id.product_quantity);
        ProductsRef = FirebaseDatabase.getInstance().getReference().child("User");


        {
            product_type = (Spinner) findViewById(R.id.spinner);
            ArrayAdapter<String> myAdapter = new ArrayAdapter<String>(this,
                    android.R.layout.simple_list_item_1, getResources().getStringArray(R.array.Products));
            myAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
            product_type.setAdapter(myAdapter);
        } //Spinner Product Type Initialization


        AddNewProductButton.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                ValidateProductData();
            }
        });


    }

    private void OpenGallery() {

        Intent galleryIntent = new Intent();
        galleryIntent.setAction(Intent.ACTION_GET_CONTENT);
        galleryIntent.setType("image/*");
        startActivityForResult(galleryIntent, GalleryPick);
    }

    private void ValidateProductData() {
        Price = pprice.getText().toString().trim();
        Pname = pname.getText().toString().trim();
        quantity = pquantity.getText().toString().trim();
        category = product_type.getSelectedItem().toString();

        if (TextUtils.isEmpty(quantity)) {
            Toast.makeText(this, "Please write product quantity...", Toast.LENGTH_SHORT).show();
        } else if (TextUtils.isEmpty(Price)) {
            Toast.makeText(this, "Please write product Price...", Toast.LENGTH_SHORT).show();
        }
        if (TextUtils.isEmpty(Pname)) {
            Toast.makeText(this, "Please write product name...", Toast.LENGTH_SHORT).show();
        } else {
            SaveProductInfoToDatabase();
        }
    }


    private void SaveProductInfoToDatabase() {

        UserData = FirebaseDatabase.getInstance().getReference()
                .child("User")
                .child("Wholesaler")
                .child(p_username)
                .child("Products")
                .child(category)
                .child(Pname)
                .child("quantity");

        UserData
                .get()
                .addOnCompleteListener(task -> {
                    if (task.isSuccessful()) {

                        HashMap<String, Object> productMap = new HashMap<>();
                        productMap.put("price", Price);
                        productMap.put("pname", Pname);

                        int newQuantity;
                        if (task.getResult().exists()) {
                            int currentQuantity = Integer.parseInt( (String )task.getResult().getValue());
                            newQuantity = Integer.parseInt(quantity) + currentQuantity;
                        } else {
                            newQuantity = Integer.parseInt(quantity);
                        }

                        productMap.put("quantity", String.valueOf(newQuantity));

                        FirebaseDatabase.getInstance().getReference().child("User").child("Wholesaler").
                                child(p_username).child("Products").child(category).child(Pname).updateChildren(productMap);

                        Toast.makeText(this, Pname+" successfully updated.", Toast.LENGTH_SHORT).show();
                    }
                });


        // if snapshot exists
        // Quantity = Quantity + temp_quantity;
        // update
//        if(InputProduct)

        // Quantdata.child(category).child(Pname).child("Wholesaler").child(p_username).updateChildren(productMap);
//        Intent intent = new Intent(getApplicationContext(), MainActivity.class);
//        startActivity(intent);
    }


    @Override
    protected void onActivityResult(int requestCode, int resultCode, @Nullable Intent data) {
        super.onActivityResult(requestCode, resultCode, data);

        if (requestCode == GalleryPick && resultCode == RESULT_OK && data != null) {
            ImageUri = data.getData();
            InputProductImage.setImageURI(ImageUri);
        }
    }
})
(dbfs:/FileStore/LiveMart/addproduct.java,package com.example.oop_project.Main;

import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.appcompat.app.AppCompatActivity;

import android.content.Context;
import android.content.Intent;
import android.content.SharedPreferences;
import android.net.Uri;
import android.os.Bundle;
import android.text.TextUtils;
import android.util.Log;
import android.view.View;
import android.widget.AdapterView;
import android.widget.ArrayAdapter;
import android.widget.Button;
import android.widget.ImageView;
import android.widget.Spinner;
import android.widget.TextView;
import android.widget.Toast;

import com.example.oop_project.R;
import com.google.android.gms.tasks.Continuation;
import com.google.android.gms.tasks.OnCompleteListener;
import com.google.android.gms.tasks.OnFailureListener;
import com.google.android.gms.tasks.OnSuccessListener;
import com.google.android.gms.tasks.Task;
import com.google.firebase.database.DataSnapshot;
import com.google.firebase.database.DatabaseError;
import com.google.firebase.database.DatabaseReference;
import com.google.firebase.database.FirebaseDatabase;
import com.google.firebase.database.ValueEventListener;
import com.google.firebase.storage.FirebaseStorage;
import com.google.firebase.storage.StorageReference;
import com.google.firebase.storage.UploadTask;

import java.util.HashMap;

import static android.widget.Toast.LENGTH_LONG;

public class addproduct extends AppCompatActivity  {

    private String quantity,Price,Pname, downloadImageUrl,category,p_username,latitude,longitude;
    private ImageView InputProductImage ;
    private static final int GalleryPick = 1;
    private Uri ImageUri;
    private Button AddNewProductButton;
    private TextView pname , pquantity , pprice;
    private StorageReference ProductImagesRef;
    private DatabaseReference ProductsRef,Quantityref,dbref,imageref;
    private Spinner product_type;







    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_admin_add_new_product);


        {
            SharedPreferences sh = getApplicationContext().getSharedPreferences("MySharedPref", Context.MODE_PRIVATE);

            // The value will be default as empty string because for
// the very first time when the app is opened, there is nothing to show
            p_username = sh.getString("username", "Babuwhole");
            Log.i("memes",p_username);
// We can then use the data
        }//SharedPrefs




        InputProductImage = findViewById(R.id.select_product_image);
        AddNewProductButton = findViewById(R.id.add_new_product);
        pname = findViewById(R.id.product_name);
        pprice = findViewById(R.id.product_price);
        pquantity = findViewById(R.id.product_quantity);
        ProductImagesRef = FirebaseStorage.getInstance().getReference().child("Product Images");


        {

            product_type = (Spinner) findViewById(R.id.spinner);
            ArrayAdapter<String> myAdapter = new ArrayAdapter<String>(this,
                    android.R.layout.simple_list_item_1, getResources().getStringArray(R.array.Products));
            myAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
            product_type.setAdapter(myAdapter);
        } //Spinner Initialization



        InputProductImage.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                OpenGallery();
            }
        });

        AddNewProductButton.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view)
            {


                ValidateProductData();
            }
        });





    }

    private void OpenGallery() {

        Intent galleryIntent = new Intent();
        galleryIntent.setAction(Intent.ACTION_GET_CONTENT);
        galleryIntent.setType("image/*");
        startActivityForResult(galleryIntent, GalleryPick);
    }

    private void ValidateProductData() {
        quantity = pquantity.getText().toString();
        Price = pprice.getText().toString();
        Pname = pname.getText().toString();
        category = product_type.getSelectedItem().toString();


        if (!(category.contains("Fruits") || !category.contains("Vegetables") )) {
            Toast.makeText(getApplicationContext(), "Please select a valid user", LENGTH_LONG).show();
        }
        else if (ImageUri == null)
       {
           Toast.makeText(this, "Product image is mandatory...", Toast.LENGTH_SHORT).show();
       }
        else if (TextUtils.isEmpty(quantity))
        {
            Toast.makeText(this, "Please give the quantity...", Toast.LENGTH_SHORT).show();
        }
        else if (TextUtils.isEmpty(Price))
        {
            Toast.makeText(this, "Please write product Price...", Toast.LENGTH_SHORT).show();
        }
        else if (TextUtils.isEmpty(Pname))
        {
            Toast.makeText(this, "Please write product name...", Toast.LENGTH_SHORT).show();
        }
        else
        {
            StoreProductInformation();
        }
    }

    private void StoreProductInformation() {

        final StorageReference filePath = ProductImagesRef.child(ImageUri.getLastPathSegment() + ".jpg");
        final UploadTask uploadTask = filePath.putFile(ImageUri);

        uploadTask.addOnFailureListener(new OnFailureListener() {
            @Override
            public void onFailure(@NonNull Exception e)
            {
                String message = e.toString();
                Toast.makeText(addproduct.this, "Error: " + message, Toast.LENGTH_SHORT).show();
            }
        }).addOnSuccessListener(new OnSuccessListener<UploadTask.TaskSnapshot>() {
            @Override
            public void onSuccess(UploadTask.TaskSnapshot taskSnapshot)
            {
                Toast.makeText(addproduct.this, "Product Image uploaded Successfully...", Toast.LENGTH_SHORT).show();

                Task<Uri> urlTask = uploadTask.continueWithTask(new Continuation<UploadTask.TaskSnapshot, Task<Uri>>() {
                    @Override
                    public Task<Uri> then(@NonNull Task<UploadTask.TaskSnapshot> task) throws Exception
                    {
                        if (!task.isSuccessful())
                        {
                            throw task.getException();
                        }

                        downloadImageUrl = filePath.getDownloadUrl().toString();
                        return filePath.getDownloadUrl();
                    }
                }).addOnCompleteListener(new OnCompleteListener<Uri>() {
                    @Override
                    public void onComplete(@NonNull Task<Uri> task)
                    {
                        if (task.isSuccessful())
                        {
                            downloadImageUrl = task.getResult().toString();

                            Toast.makeText(addproduct.this, "got the Product image Url Successfully...", Toast.LENGTH_SHORT).show();

                            SaveProductInfoToDatabase();
                        }
                    }
                });
            }
        });

    }

    private void SaveProductInfoToDatabase() {





        {
            dbref = FirebaseDatabase.getInstance().getReference().child("User").child("Wholesaler").child(p_username).child("Details");
            dbref.addValueEventListener(new ValueEventListener() {
                @Override
                public void onDataChange(@NonNull DataSnapshot snapshot) {
                    latitude = snapshot.child("latitude").getValue().toString();
                    Log.e("memes", latitude);
                    longitude = snapshot.child("longitude").getValue().toString();
                    Log.e("memes", longitude);
                }

                @Override
                public void onCancelled(@NonNull DatabaseError error) {

                }
            });
        }//Coordinate Extraction

        {
            ProductsRef = FirebaseDatabase.getInstance().getReference().child("User").child("Wholesaler").child(p_username).child("Products");

            HashMap<String, Object> productMap = new HashMap<>();
            productMap.put("pname", Pname);
            productMap.put("price", Price);
            productMap.put("quantity", quantity);

            ProductsRef.child(category).child(Pname).updateChildren(productMap);
        }//Productref

        {
            Quantityref = FirebaseDatabase.getInstance().getReference().child("Quantity").child(category).child(Pname).child("Wholesaler").child(p_username);
            HashMap<String, Object> quantityMap = new HashMap<>();
            quantityMap.put("rname", p_username);
            quantityMap.put("price", Price);
            quantityMap.put("quantity",quantity);
            quantityMap.put("latitude",latitude);
            quantityMap.put("longitude",longitude);

            Quantityref.updateChildren(quantityMap);
        }//QuantityRef

        {
            imageref = FirebaseDatabase.getInstance().getReference().child("Products").child(category).child(Pname);
            HashMap<String, Object> imagemap = new HashMap<>();
            imagemap.put("pname",Pname);
            imagemap.put("status","Approved");
            imagemap.put("image",downloadImageUrl);

            imageref.updateChildren(imagemap);
        }//Imageref



    }


    @Override
    protected void onActivityResult(int requestCode, int resultCode, @Nullable Intent data) {
        super.onActivityResult(requestCode, resultCode, data);

        if (requestCode==GalleryPick  &&  resultCode==RESULT_OK  &&  data!=null)
        {
            ImageUri = data.getData();
            InputProductImage.setImageURI(ImageUri);
        }
    }
})
(dbfs:/FileStore/LiveMart/otp_extra/entermobilenumber.java,//package com.example.oop_project.Main.otp_extra;
//
//import androidx.annotation.NonNull;
//import androidx.appcompat.app.AppCompatActivity;
//
//import android.content.Intent;
//import android.os.Bundle;
//import android.view.View;
//import android.widget.Button;
//import android.widget.EditText;
//import android.widget.ProgressBar;
//import android.widget.Toast;
//
//import com.example.oop_project.R;
//import com.google.firebase.FirebaseException;
//import com.google.firebase.auth.PhoneAuthCredential;
//import com.google.firebase.auth.PhoneAuthProvider;
//
//import java.util.concurrent.TimeUnit;
//
//public class entermobilenumber extends AppCompatActivity {
//
//    EditText enternumber;
//    Button getotpbuttoon;
//    ProgressBar progressBar;
//
//    @Override
//    protected void onCreate(Bundle savedInstanceState) {
//        super.onCreate(savedInstanceState);
//        setContentView(R.layout.activity_entermobilenumber);
//
//        enternumber = findViewById(R.id.phone_number);
//        getotpbuttoon = findViewById(R.id.get_otp);
//        progressBar = findViewById(R.id.progressbar_verifyotp);
//
//        getotpbuttoon.setOnClickListener(new View.OnClickListener() {
//            @Override
//            public void onClick(View v) {
//                if (!enternumber.getText().toString().trim().isEmpty()) {
//                    if ((enternumber.getText().toString().trim().length() == 10)) {
//
//
//                        progressBar.setVisibility(View.VISIBLE);
//                        getotpbuttoon.setVisibility(View.INVISIBLE);
//
//                        PhoneAuthProvider.getInstance().verifyPhoneNumber(
//                                "+91" + enternumber.getText().toString().trim(),
//                                60,
//                                TimeUnit.SECONDS,
//                                entermobilenumber.this,
//                                new PhoneAuthProvider.OnVerificationStateChangedCallbacks() {
//                                    @Override
//                                    public void onVerificationCompleted(@NonNull PhoneAuthCredential phoneAuthCredential) {
//                                        progressBar.setVisibility(View.GONE);
//                                        getotpbuttoon.setVisibility(View.VISIBLE);
//                                    }
//
//                                    @Override
//                                    public void onVerificationFailed(@NonNull FirebaseException e) {
//                                        progressBar.setVisibility(View.GONE);
//                                        getotpbuttoon.setVisibility(View.VISIBLE);
//                                        Toast.makeText(getApplicationContext(), e.getMessage(), Toast.LENGTH_SHORT).show();
//                                    }
//
//                                    @Override
//                                    public void onCodeSent(@NonNull String backendotp, @NonNull PhoneAuthProvider.ForceResendingToken forceResendingToken) {
//                                        progressBar.setVisibility(View.GONE);
//                                        getotpbuttoon.setVisibility(View.VISIBLE);
//                                        Intent intent = new Intent(getApplicationContext(), verifyenterotptwo.class);
//                                        intent.putExtra("mobile", enternumber.getText().toString().trim());
//                                        intent.putExtra("backendotp", backendotp);
//                                        startActivity(intent);
//
//                                    }
//                                }
//
//                        );
//
//
//                    } else {
//                        Toast.makeText(getApplicationContext(), "Please enter the correct Mobile Number", Toast.LENGTH_SHORT).show();
//                    }
//
//                } else {
//                    Toast.makeText(getApplicationContext(), "Please enter your Mobile Number", Toast.LENGTH_SHORT).show();
//
//                }
//            }
//        });
//
//
//    }
//})
(dbfs:/FileStore/LiveMart/otp_extra/verifyenterotptwo.java,//package com.example.oop_project.Main.otp_extra;
//
//import androidx.annotation.NonNull;
//import androidx.appcompat.app.AppCompatActivity;
//
//import android.content.Intent;
//import android.os.Bundle;
//import android.text.Editable;
//import android.text.TextWatcher;
//import android.view.View;
//import android.widget.Button;
//import android.widget.EditText;
//import android.widget.ProgressBar;
//import android.widget.TextView;
//import android.widget.Toast;
//
//import com.example.oop_project.R;
//import com.example.oop_project.Main.addproduct;
//import com.google.android.gms.tasks.OnCompleteListener;
//import com.google.android.gms.tasks.Task;
//import com.google.firebase.FirebaseException;
//import com.google.firebase.auth.AuthResult;
//import com.google.firebase.auth.FirebaseAuth;
//import com.google.firebase.auth.PhoneAuthCredential;
//import com.google.firebase.auth.PhoneAuthProvider;
//
//import java.util.concurrent.TimeUnit;
//
//public class verifyenterotptwo extends AppCompatActivity {
//
//    EditText iptn1, iptn2, iptn3, iptn4, iptn5, iptn6;
//    TextView tview;
//
//    String getotpbackend;
//
//
//    @Override
//    protected void onCreate(Bundle savedInstanceState) {
//        super.onCreate(savedInstanceState);
//        setContentView(R.layout.activity_verifyenterotptwo);
//
//        iptn1 = findViewById(R.id.inputotp1);
//        iptn2 = findViewById(R.id.inputotp2);
//        iptn3 = findViewById(R.id.inputotp3);
//        iptn4 = findViewById(R.id.inputotp4);
//        iptn5 = findViewById(R.id.inputotp5);
//        iptn6 = findViewById(R.id.inputotp6);
//
//        tview = findViewById(R.id.textmobileshow);
//
//        tview.setText(String.format(
//                "+91-%s", getIntent().getStringExtra("mobile")
//        ));
//
//        getotpbackend = getIntent().getStringExtra("backendotp");
//
//        final ProgressBar progressBar1 = findViewById(R.id.progressbar_sendotp);
//
//        final Button setotp = findViewById(R.id.verify_otp);
//
//        setotp.setOnClickListener(new View.OnClickListener() {
//            @Override
//            public void onClick(View v) {
//
//
//                if (!iptn1.getText().toString().trim().isEmpty() && !iptn2.getText().toString().trim().isEmpty() && !iptn3.getText().toString().trim().isEmpty() && !iptn4.getText().toString().trim().isEmpty() && !iptn5.getText().toString().trim().isEmpty() && !iptn6.getText().toString().trim().isEmpty()) {
//                    String entercodeotp = iptn1.getText().toString() +
//                            iptn2.getText().toString() +
//                            iptn3.getText().toString() +
//                            iptn4.getText().toString() +
//                            iptn5.getText().toString() +
//                            iptn6.getText().toString();
//                    if (getotpbackend != null) {
//                        progressBar1.setVisibility(View.VISIBLE);
//                        setotp.setVisibility(View.INVISIBLE);
//
//                        PhoneAuthCredential phoneAuthCredential = PhoneAuthProvider.getCredential(
//                                getotpbackend, entercodeotp
//                        );
//                        FirebaseAuth.getInstance().signInWithCredential(phoneAuthCredential)
//                                .addOnCompleteListener(new OnCompleteListener<AuthResult>() {
//                                    @Override
//                                    public void onComplete(@NonNull Task<AuthResult> task) {
//                                        progressBar1.setVisibility(View.GONE);
//                                        setotp.setVisibility(View.VISIBLE);
//
//                                        if (task.isSuccessful()) {
//                                            Intent intent = new Intent(getApplicationContext(), addproduct.class);
//                                            intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);
//                                            startActivity(intent);
//                                        } else {
//                                            Toast.makeText(verifyenterotptwo.this, "Enter the cprrect otp", Toast.LENGTH_SHORT).show();
//                                        }
//                                    }
//                                });
//                    } else {
//                        Toast.makeText(getApplicationContext(), "Please check Internet Connection", Toast.LENGTH_SHORT).show();
//                    }
//
////                    Toast.makeText(getApplicationContext(), "Verifying OTP", Toast.LENGTH_SHORT).show();
//                } else {
//                    Toast.makeText(getApplicationContext(), "Please enter the OTP properly!", Toast.LENGTH_SHORT).show();
//                }
//            }
//        });
//
//        numberotpmove();
//
//
//        findViewById(R.id.resend_otp).setOnClickListener(new View.OnClickListener() {
//            @Override
//            public void onClick(View v) {
//
//                PhoneAuthProvider.getInstance().verifyPhoneNumber(
//                        "+91" + getIntent().getStringExtra("mobile"),
//                        60,
//                        TimeUnit.SECONDS,
//                        verifyenterotptwo.this,
//                        new PhoneAuthProvider.OnVerificationStateChangedCallbacks() {
//                            @Override
//                            public void onVerificationCompleted(@NonNull PhoneAuthCredential phoneAuthCredential) {
//
//                            }
//
//                            @Override
//                            public void onVerificationFailed(@NonNull FirebaseException e) {
//
//                                Toast.makeText(getApplicationContext(), e.getMessage(), Toast.LENGTH_SHORT).show();
//                            }
//
//                            @Override
//                            public void onCodeSent(@NonNull String newbackendotp, @NonNull PhoneAuthProvider.ForceResendingToken forceResendingToken) {
//
//                                getotpbackend = newbackendotp;
//                                Toast.makeText(verifyenterotptwo.this, "OTP sent successfully", Toast.LENGTH_SHORT).show();
//
//                            }
//                        }
//
//                );
//
//            }
//        });
//
//    }
//
//    private void numberotpmove() {
//
//        iptn1.addTextChangedListener(new TextWatcher() {
//            @Override
//            public void beforeTextChanged(CharSequence s, int start, int count, int after) {
//
//            }
//
//            @Override
//            public void onTextChanged(CharSequence s, int start, int before, int count) {
//                if (!s.toString().trim().isEmpty()) {
//                    iptn2.requestFocus();
//                }
//            }
//
//            @Override
//            public void afterTextChanged(Editable s) {
//
//            }
//        });
//
//        iptn2.addTextChangedListener(new TextWatcher() {
//            @Override
//            public void beforeTextChanged(CharSequence s, int start, int count, int after) {
//
//            }
//
//            @Override
//            public void onTextChanged(CharSequence s, int start, int before, int count) {
//                if (!s.toString().trim().isEmpty()) {
//                    iptn3.requestFocus();
//                }
//            }
//
//            @Override
//            public void afterTextChanged(Editable s) {
//
//            }
//        });
//
//        iptn3.addTextChangedListener(new TextWatcher() {
//            @Override
//            public void beforeTextChanged(CharSequence s, int start, int count, int after) {
//
//            }
//
//            @Override
//            public void onTextChanged(CharSequence s, int start, int before, int count) {
//                if (!s.toString().trim().isEmpty()) {
//                    iptn4.requestFocus();
//                }
//            }
//
//            @Override
//            public void afterTextChanged(Editable s) {
//
//            }
//        });
//
//        iptn4.addTextChangedListener(new TextWatcher() {
//            @Override
//            public void beforeTextChanged(CharSequence s, int start, int count, int after) {
//
//            }
//
//            @Override
//            public void onTextChanged(CharSequence s, int start, int before, int count) {
//                if (!s.toString().trim().isEmpty()) {
//                    iptn5.requestFocus();
//                }
//            }
//
//            @Override
//            public void afterTextChanged(Editable s) {
//
//            }
//        });
//
//        iptn5.addTextChangedListener(new TextWatcher() {
//            @Override
//            public void beforeTextChanged(CharSequence s, int start, int count, int after) {
//
//            }
//
//            @Override
//            public void onTextChanged(CharSequence s, int start, int before, int count) {
//                if (!s.toString().trim().isEmpty()) {
//                    iptn6.requestFocus();
//                }
//            }
//
//            @Override
//            public void afterTextChanged(Editable s) {
//
//            }
//        });
//
//
//    }
//
//
//
//})
